
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>JavaScript htmlentities function - php.js</title>
  <meta name="author" content="Kevin van Zonneveld">

  
  <meta name="description" content="JavaScript htmlentities function A JavaScript equivalent of PHP&#8217;s htmlentities strings/htmlentities.js raw on github 1
2
3
4
5
6
7
8
9
10
11 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://phpjs.org/functions/htmlentities/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="php.js" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-63083-7']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">php</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">.js</a></h1>
  
    <h2>A resource of php functions in JavaScript</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:phpjs.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Blog</a></li>
  <li><a href="/functions">Functions</a></li>
  <li><a href="/authors">Authors</a></li>
  <li><a target="_blank" href="https://github.com/kvz/phpjs/wiki/_pages">Wiki</a></li>
  <li><a target="_blank"  href="http://twitter.com/phpjs">@phpjs</a></li>
  <li><a target="_blank"  href="http://identi.ca/brettz9">@brettz9</a></li>
  <li><a target="_blank"  href="http://twitter.com/kvz">@kvz</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">JavaScript htmlentities function</h1>
    
  </header>
  
  <!-- Generated by Rakefile:build -->


<p>A JavaScript equivalent of PHP&#8217;s htmlentities</p>

<figure class='code'><figcaption><span>strings/htmlentities.js </span><a href='https://raw.github.com/kvz/phpjs/master/functions/strings/htmlentities.js'>raw on github </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">htmlentities</span> <span class="p">(</span><span class="nx">string</span><span class="p">,</span> <span class="nx">quote_style</span><span class="p">,</span> <span class="nx">charset</span><span class="p">,</span> <span class="nx">double_encode</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// http://kevin.vanzonneveld.net</span>
</span><span class='line'>  <span class="c1">// +   original by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)</span>
</span><span class='line'>  <span class="c1">// +    revised by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)</span>
</span><span class='line'>  <span class="c1">// +   improved by: nobbler</span>
</span><span class='line'>  <span class="c1">// +    tweaked by: Jack</span>
</span><span class='line'>  <span class="c1">// +   bugfixed by: Onno Marsman</span>
</span><span class='line'>  <span class="c1">// +    revised by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)</span>
</span><span class='line'>  <span class="c1">// +    bugfixed by: Brett Zamir (http://brett-zamir.me)</span>
</span><span class='line'>  <span class="c1">// +      input by: Ratheous</span>
</span><span class='line'>  <span class="c1">// +   improved by: Rafa≈Ç Kukawski (http://blog.kukawski.pl)</span>
</span><span class='line'>  <span class="c1">// +   improved by: Dj (http://phpjs.org/functions/htmlentities:425#comment_134018)</span>
</span><span class='line'>  <span class="c1">// -    depends on: get_html_translation_table</span>
</span><span class='line'>  <span class="c1">// *     example 1: htmlentities(&#39;Kevin &amp; van Zonneveld&#39;);</span>
</span><span class='line'>  <span class="c1">// *     returns 1: &#39;Kevin &amp;amp; van Zonneveld&#39;</span>
</span><span class='line'>  <span class="c1">// *     example 2: htmlentities(&quot;foo&#39;bar&quot;,&quot;ENT_QUOTES&quot;);</span>
</span><span class='line'>  <span class="c1">// *     returns 2: &#39;foo&amp;#039;bar&#39;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">hash_map</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get_html_translation_table</span><span class="p">(</span><span class="s1">&#39;HTML_ENTITIES&#39;</span><span class="p">,</span> <span class="nx">quote_style</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">symbol</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">string</span> <span class="o">=</span> <span class="nx">string</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">string</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hash_map</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">quote_style</span> <span class="o">&amp;&amp;</span> <span class="nx">quote_style</span> <span class="o">===</span> <span class="s1">&#39;ENT_QUOTES&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">hash_map</span><span class="p">[</span><span class="s2">&quot;&#39;&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&amp;#039;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!!</span><span class="nx">double_encode</span> <span class="o">||</span> <span class="nx">double_encode</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="nx">symbol</span> <span class="k">in</span> <span class="nx">hash_map</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">hash_map</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">symbol</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">string</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">symbol</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">hash_map</span><span class="p">[</span><span class="nx">symbol</span><span class="p">]);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">string</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([\s\S]*?)(&amp;(?:#\d+|#x[\da-f]+|[a-zA-Z][\da-z]*);|$)/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">ignore</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">entity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="nx">symbol</span> <span class="k">in</span> <span class="nx">hash_map</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">hash_map</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">symbol</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">symbol</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">hash_map</span><span class="p">[</span><span class="nx">symbol</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nx">text</span> <span class="o">+</span> <span class="nx">entity</span><span class="p">;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nx">string</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://github.com/kvz/phpjs/blob/master/functions/strings/htmlentities.js">view on github</a></li>
<li><a href="https://github.com/kvz/phpjs/edit/master/functions/strings/htmlentities.js">edit on github</a></li>
</ul>


<h3>Example 1</h3>

<p>This code</p>

<figure class='code'><figcaption><span>example </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">htmlentities</span><span class="p">(</span><span class="s1">&#39;Kevin &amp; van Zonneveld&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Should return</p>

<figure class='code'><figcaption><span>returns </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s1">&#39;Kevin &amp;amp; van Zonneveld&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Example 2</h3>

<p>This code</p>

<figure class='code'><figcaption><span>example </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">htmlentities</span><span class="p">(</span><span class="s2">&quot;foo&#39;bar&quot;</span><span class="p">,</span><span class="s2">&quot;ENT_QUOTES&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Should return</p>

<figure class='code'><figcaption><span>returns </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s1">&#39;foo&amp;#039;bar&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Other PHP functions in the strings extension</h3>

<!-- Generated by Rakefile:build -->


<ul>
<li><a href="/functions/addcslashes">addcslashes</a></li>
<li><a href="/functions/addslashes">addslashes</a></li>
<li><a href="/functions/bin2hex">bin2hex</a></li>
<li><a href="/functions/chop">chop</a></li>
<li><a href="/functions/chr">chr</a></li>
<li><a href="/functions/chunk_split">chunk_split</a></li>
<li><a href="/functions/convert_cyr_string">convert_cyr_string</a></li>
<li><a href="/functions/convert_uuencode">convert_uuencode</a></li>
<li><a href="/functions/count_chars">count_chars</a></li>
<li><a href="/functions/crc32">crc32</a></li>
<li><a href="/functions/echo">echo</a></li>
<li><a href="/functions/explode">explode</a></li>
<li><a href="/functions/get_html_translation_table">get_html_translation_table</a></li>
<li><a href="/functions/html_entity_decode">html_entity_decode</a></li>
<li><a href="/functions/htmlentities">htmlentities</a></li>
<li><a href="/functions/htmlspecialchars">htmlspecialchars</a></li>
<li><a href="/functions/htmlspecialchars_decode">htmlspecialchars_decode</a></li>
<li><a href="/functions/implode">implode</a></li>
<li><a href="/functions/join">join</a></li>
<li><a href="/functions/lcfirst">lcfirst</a></li>
<li><a href="/functions/levenshtein">levenshtein</a></li>
<li><a href="/functions/localeconv">localeconv</a></li>
<li><a href="/functions/ltrim">ltrim</a></li>
<li><a href="/functions/md5">md5</a></li>
<li><a href="/functions/md5_file">md5_file</a></li>
<li><a href="/functions/metaphone">metaphone</a></li>
<li><a href="/functions/money_format">money_format</a></li>
<li><a href="/functions/nl2br">nl2br</a></li>
<li><a href="/functions/nl_langinfo">nl_langinfo</a></li>
<li><a href="/functions/number_format">number_format</a></li>
<li><a href="/functions/ord">ord</a></li>
<li><a href="/functions/parse_str">parse_str</a></li>
<li><a href="/functions/printf">printf</a></li>
<li><a href="/functions/quoted_printable_decode">quoted_printable_decode</a></li>
<li><a href="/functions/quoted_printable_encode">quoted_printable_encode</a></li>
<li><a href="/functions/quotemeta">quotemeta</a></li>
<li><a href="/functions/rtrim">rtrim</a></li>
<li><a href="/functions/setlocale">setlocale</a></li>
<li><a href="/functions/sha1">sha1</a></li>
<li><a href="/functions/sha1_file">sha1_file</a></li>
<li><a href="/functions/similar_text">similar_text</a></li>
<li><a href="/functions/soundex">soundex</a></li>
<li><a href="/functions/split">split</a></li>
<li><a href="/functions/sprintf">sprintf</a></li>
<li><a href="/functions/sscanf">sscanf</a></li>
<li><a href="/functions/str_getcsv">str_getcsv</a></li>
<li><a href="/functions/str_ireplace">str_ireplace</a></li>
<li><a href="/functions/str_pad">str_pad</a></li>
<li><a href="/functions/str_repeat">str_repeat</a></li>
<li><a href="/functions/str_replace">str_replace</a></li>
<li><a href="/functions/str_rot13">str_rot13</a></li>
<li><a href="/functions/str_shuffle">str_shuffle</a></li>
<li><a href="/functions/str_split">str_split</a></li>
<li><a href="/functions/str_word_count">str_word_count</a></li>
<li><a href="/functions/strcasecmp">strcasecmp</a></li>
<li><a href="/functions/strchr">strchr</a></li>
<li><a href="/functions/strcmp">strcmp</a></li>
<li><a href="/functions/strcoll">strcoll</a></li>
<li><a href="/functions/strcspn">strcspn</a></li>
<li><a href="/functions/strip_tags">strip_tags</a></li>
<li><a href="/functions/stripos">stripos</a></li>
<li><a href="/functions/stripslashes">stripslashes</a></li>
<li><a href="/functions/stristr">stristr</a></li>
<li><a href="/functions/strlen">strlen</a></li>
<li><a href="/functions/strnatcasecmp">strnatcasecmp</a></li>
<li><a href="/functions/strnatcmp">strnatcmp</a></li>
<li><a href="/functions/strncasecmp">strncasecmp</a></li>
<li><a href="/functions/strncmp">strncmp</a></li>
<li><a href="/functions/strpbrk">strpbrk</a></li>
<li><a href="/functions/strpos">strpos</a></li>
<li><a href="/functions/strrchr">strrchr</a></li>
<li><a href="/functions/strrev">strrev</a></li>
<li><a href="/functions/strripos">strripos</a></li>
<li><a href="/functions/strrpos">strrpos</a></li>
<li><a href="/functions/strspn">strspn</a></li>
<li><a href="/functions/strstr">strstr</a></li>
<li><a href="/functions/strtok">strtok</a></li>
<li><a href="/functions/strtolower">strtolower</a></li>
<li><a href="/functions/strtoupper">strtoupper</a></li>
<li><a href="/functions/strtr">strtr</a></li>
<li><a href="/functions/substr">substr</a></li>
<li><a href="/functions/substr_compare">substr_compare</a></li>
<li><a href="/functions/substr_count">substr_count</a></li>
<li><a href="/functions/substr_replace">substr_replace</a></li>
<li><a href="/functions/trim">trim</a></li>
<li><a href="/functions/ucfirst">ucfirst</a></li>
<li><a href="/functions/ucwords">ucwords</a></li>
<li><a href="/functions/vprintf">vprintf</a></li>
<li><a href="/functions/vsprintf">vsprintf</a></li>
<li><a href="/functions/wordwrap">wordwrap</a></li>
</ul>


<h2>Legacy comments</h2>

<p>These were imported from our old site. Please use disqus below for new comments</p>

<div style="overflow-y: scroll; max-height: 500px;">
<!-- Generated by Rakefile:build -->

<strong>
<a href="www.gooogle.com" rel="nofollow">deepak</a>
</strong>
on 2012-08-06 18:54:10 <br />
deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu deepak sahu 
<hr />


<strong>
Max von Buelow
</strong>
on 2012-07-25 16:08:45 <br />
The Code from line 29 to line 31 is already provided by get_html_translation_table:
<pre><code>
    if (useQuoteStyle === 'ENT_QUOTES') {
        entities['39'] = '&amp;#39;';
    }
</code></pre>
<hr />


<strong>
Hans Henrik
</strong>
on 2012-02-29 19:36:49 <br />
this code isn&#8217;t even close to complete. 
like 
<pre><code>
√¶=&amp;aelig;
√∏=&amp;oslash;
√•=&amp;aring;
√Ü=&amp;AElig;
√ò=&amp;Oslash;
√Ö=&amp;Aring;
</code></pre>
and there&#8217;s lots of others missing 2 :p
<hr />


<strong>
Eu
</strong>
on 2011-12-20 02:50:18 <br />
&lt;script&gt;alert(&#8216;hi&#8217;)&lt;/script&gt;
<hr />


<strong>
Komal
</strong>
on 2011-09-20 09:32:24 <br />
Thanks a lot @Rafa≈Ç 

I update the function htmlentities() from github and it works fine&#8230; :)
<hr />


<strong>
Rafa? Kukawski
</strong>
on 2011-09-17 16:16:22 <br />
@Komal: try using new get_html_translation_table and htmlentities (depends on the first one) functions from git https://github.com/kvz/phpjs/commit/f9a42874e652d096245797c155f65a25a667b528
<hr />


<strong>
Komal
</strong>
on 2011-09-17 10:47:57 <br />
Hi,
I am using ur code in one of my functionality but when I use &quot;extend&quot; word then its shwoing me some code as output instead of &quot;extend&quot;
e.g., 
<pre><code>
var str = htmlentities(&quot;test extend&quot;,&quot;ENT_QUOTES&quot;);
</code></pre>

// Output in am getting is 
test function(object) { return Object.extend.apply(this, [this, object]); }  

It means &quot;extend&quot; word is replaced by &quot;function(object) { return Object.extend.apply(this, [this, object]); }&quot;

Can someone please check on this.

Thanks in Advanced.
- Komal
<hr />


<strong>
Rafa? Kukawski
</strong>
on 2011-07-30 12:32:43 <br />
@Dj: thanks for your feedback. Changed the function according to your suggestions. You can see the changes on github.
<hr />


<strong>
Dj
</strong>
on 2011-07-29 21:12:38 <br />
Note that the regex for double encode is not correct because it does not inglude html entities for uppercase characters, like &amp;Ntilde;

replace [a-z][\da-z] with [a-zA-Z][\da-z]
<hr />


<strong>
Dj
</strong>
on 2011-07-28 03:31:08 <br />
Here one optimized version.
Using recursion calling self.htmlentities() will cause to load the table again and check source values, which does not make sense because you are using the same table.
So instead of recursion, use a simple loop working in the same scope.

<pre><code>
function htmlentities (string, quote_style, charset, double_encode) {
    string = string !== undefined ? string + '' : '';
    var hash_map = this.get_html_translation_table('HTML_ENTITIES', quote_style),
         char;

    if (hash_map === false) {
        return false;
    }

    if (quote_style &amp;&amp; quote_style === 'ENT_QUOTES') {
        hash_map[&quot;'&quot;] = '&amp;#039;';
    }
    
    if (!!double_encode || double_encode == null) {
        for (char in hash_map) {
            string = string.split(char).join(hash_map[char]);
        }
        return string;

    } else {
        return string.replace(/([\s\S]*?)(&amp;(?:#\d+|#x[\da-f]+|[a-z][\da-z]*);|$)/g, function (ignore, text, entity) {
            for (char in hash_map) {
               text = text.split(char).join(hash_map[char]);
            }
            return text + entity;
        });
    }
}
</code></pre>
<hr />


<strong>
Dj
</strong>
on 2011-07-28 03:05:33 <br />
Note that you have a bug.
hash_map[&quot;&#8217;&quot;] = &#8216;&amp;#039;&#8217;; should only be added when quote_style is ENT_QUOTES, otherwise the single quote will be allways converted independent of the quote style specified
<hr />


<strong>
<a href="empowertheweb.com" rel="nofollow"></a>
</strong>
on 2011-06-29 18:21:30 <br />
Minified
<pre><code>
function htmlentities (s, qS, cS, dE)
{
    var h = {}, c = '', e = '', se=this;
    s += '';

    if (false === (h = se.get_html_translation_table('HTML_ENTITIES', qS)))
    {
        return false;
    }
    if (!!dE || dE == null)
    {
        h[&quot;'&quot;] = '&amp;#039;';
        for (c in h) s = s.split(c).join(h[c]);
    }
    else
    {
        s = s.replace(/([\s\S]*?)(&amp;(?:#\d+|#x[\da-f]+|[a-z][\da-z]*);|$)/g, function (i,t,e) {
            return se.htmlentities(t, qS, cS) + e;
        });
    }
    return s;
}
</code></pre>
<hr />


<strong>
Rafa? Kukawski
</strong>
on 2011-05-01 12:40:41 <br />
@Shefik: function with double_encode support landed on git
<hr />


<strong>
<a href="http://www.allknightaccess.com/" rel="nofollow">Shefik</a>
</strong>
on 2011-05-01 09:30:30 <br />
Will the parameter &quot;double_encode&quot; be added in future release of this function?
<hr />


<strong>
<a href="http://blog.kukawski.pl" rel="nofollow">Rafa? Kukawski</a>
</strong>
on 2011-01-25 09:34:25 <br />
@Aikar: Are you absolutely sure your fix is correct? Simple changing from .split() to .replace() won&#8217;t work correctly, unless you pass a regular expression with &#8216;g&#8217; flag to .replace. When doing str.replace(&#8216;foo&#8217;, &#8216;bar&#8217;), JavaScript replaces only first occurrence of &#8216;foo&#8217; (http://jsfiddle.net/8ydqr/). Creating a new instance of RegExp object for every character (and escaping the character if required) would also take longer time to execute. But yes, this functions needs some optimizations.
<hr />


<strong>
<a href="http://aikar.co" rel="nofollow">Aikar</a>
</strong>
on 2011-01-25 05:31:18 <br />
Grr I realize I messed up variable names when I was cutting out that code and it was essentially running nothing&#8230; But after fixing it it still got down to 9000ms which is an 80% performance gain, so it needs to be modified.
<hr />


<strong>
<a href="http://aikar.co" rel="nofollow">Aikar</a>
</strong>
on 2011-01-25 05:17:08 <br />
Follow up, changing tmp_str.split to tmp_str.replace(symbol, entity); sped it up by 22% (10s~)

Then I furthur fixed the entire thing and did it properly, so can someone who knows how to update these functions implement this:

https://gist.github.com/794497

Got my benchmark back down to where it was suppose to be with the above pasted versions:
&gt;&gt;&gt; node benchmark.js
rendered 10000 times in 3200ms!
<hr />


<strong>
<a href="http://aikar.co" rel="nofollow">Aikar</a>
</strong>
on 2011-01-25 04:53:38 <br />
This code is extremely slow&#8230;
I did a benchmark before and after adding this to my strings

BEFORE:
&gt;&gt;&gt; node benchmark.js
rendered 10000 times in 3192ms!

AFTER:
&gt;&gt;&gt; node benchmark.js
rendered 10000 times in 42797ms!

Use with caution.
<hr />


<strong>
<a href="http://aikar.co" rel="nofollow">Aikar</a>
</strong>
on 2011-01-25 04:53:18 <br />
This code is extremely slow&#8230;
I did a benchmark before and after adding this to my strings

BEFORE:
&gt;&gt;&gt; node benchmark.js
rendered 10000 times in 3192ms!

AFTER:
&gt;&gt;&gt; node benchmark.js
rendered 10000 times in 42797ms!

Use with caution.
<hr />


<strong>
<a href="http://blog.petrykowski.net" rel="nofollow">Jakub</a>
</strong>
on 2010-11-27 12:50:51 <br />
Hi, very useful function, however, it seems to  be missing double_encode optional argument. htmlspecialchars has it. This argument is from PHP original functions.

I had an issue with current version of the htmlentities function in Chrome dev browser (but not in FF or IE 8):

when I run htmlentities(&#8216;&quot;&#8217;) it doesn&#8217;t return $quot; but &amp;amp;quot; which is broken obviously. htmlspecialchars() returns &amp;quot; as expected. 

PHP htmlentities(&#8216;&quot;&#8217;) also returns &amp;quot; 

IE or FF return what is expected. I don&#8217;t know where the problem is, but it does look as if double encoding for amperand and quote takes place. I don&#8217;t know why one browser interprets this code in a different way than others&#8230;
<hr />


<strong>
<a href="http://www.satya-weblog.com" rel="nofollow">Satya Prakash</a>
</strong>
on 2010-11-15 13:32:28 <br />
hi
I feel this function has a bug. It cannot preserve single quote (&#8216;), when used ENT_NOQUOTES.

So, I need to use strtr() for that:

<pre><code>
var tmpVal = html_entity_decode (txtAreaVal);

txtArea.value = htmlentities(tmpVal, &quot;ENT_NOQUOTES&quot;);

// restore single quote
$trans = {'&amp;#039;' : &quot;'&quot; };
txtArea.value = strtr(txtArea.value, $trans);
</code></pre>
<hr />


<strong>
Gerry
</strong>
on 2010-11-08 21:05:13 <br />
Thanks. Great function.
<hr />


<strong>
austin
</strong>
on 2010-06-07 16:48:44 <br />
Brett: i think its more for data coming FROM the server.
in my case its an email client and i want to send them html that might be in an email, but i want to convert it to source by encoding all the tags but allow a function to put it out as actual html if the user agrees to it. since i cant know what email IS and ISNT safe for them to view, and since its a browser based email its even more dangerous as it runs in the context of that page. i would just strip ALL html, but some i need (such as the html reports made by svnnotify, they just dont look the same when you strip the tags)

but you are correct, this should NOT be used for client-side sanitization. nothing from a client should be considered secure.
<hr />


<strong>
<a href="http://brett-zamir.me" rel="nofollow">Brett Zamir</a>
</strong>
on 2009-08-30 04:44:56 <br />
@vikal: 1) Why do you want to convert it to an entity?  If you are trying to filter user input on the client-side, doing it this way is not a safe way to do it, since people can get around it. You should use your database&#8217;s own escape mechanisms instead (e.g., mysql_real_escape_string for MySQL).  2) If you do really want the entity form, you can use &amp;#92; or &amp;#x5c; , but there is no need to escape it in HTML or XML like this since a backslash is not reserved there.
<hr />


<strong>
<a href="braindigit.com" rel="nofollow">vikal</a>
</strong>
on 2009-08-27 07:17:11 <br />
hi

though your function 

htmlentities()

is good

but 

now we are having problem with this symbol \

do you have any idea how to convert it to the html entities

is there any solution so that i can change

\ to htmlentities

hoping best here

regards

vikal


<hr />


<strong>
<a href="http://brett-zamir.me" rel="nofollow">Brett Zamir</a>
</strong>
on 2009-08-26 07:57:47 <br />
@vikal: Does that mean you figured out the problem with the function? If you are still having trouble, please give a precise example where you see the problem. Thanks&#8230;
<hr />


<strong>
<a href="www.braindigit.com" rel="nofollow">vikal</a>
</strong>
on 2009-08-26 07:50:05 <br />
hi

Really good work that you people accomplished.

so useful and i am happy to use it.

thanks

best regards

vikal acharya
<hr />


<strong>
<a href="braindigit.com" rel="nofollow">vikal</a>
</strong>
on 2009-08-24 13:16:29 <br />
hi

i have used your code to convert &lt;!&#8212;-&gt; into html entities..

but it does not work neither it return what i need.

i have used your code as it descripted in examples

like this


function htmlentities (string) {
    // Convert all applicable characters to HTML entities  
    // 
    // version: 907.503
    // discuss at: http://phpjs.org/functions/htmlentities
    // +   original by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
    // +    revised by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
    // +   improved by: nobbler
    // +    tweaked by: Jack
    // +   bugfixed by: Onno Marsman
    // +    revised by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
    // +    bugfixed by: Brett Zamir (http://brett-zamir.me)
    // +      input by: Ratheous
    // -    depends on: get_html_translation_table
    // *     example 1: htmlentities(&#8216;Kevin &amp; van Zonneveld&#8217;);
    // *     returns 1: &#8216;Kevin &amp;amp; van Zonneveld&#8217;
    // *     example 2: htmlentities(&quot;foo&#8217;bar&quot;,&quot;ENT_QUOTES&quot;);
    // *     returns 2: &#8216;foo&amp;#039;bar&#8217;
    var hash_map = {}, symbol = &#8221;, tmp_str = &#8221;, entity = &#8221;;
    tmp_str = string.toString();
    
    if (false === (hash_map = this.get_html_translation_table(&#8216;HTML_ENTITIES&#8217;, &#8216;ENT_COMPAT&#8217;))) {
        return false;
    }
     for (symbol in hash_map) {
        entity = hash_map[symbol];
        tmp_str = tmp_str.split(symbol).join(entity);
    }
    
    return tmp_str;
}

including function get_html_translation_table() as it is

so would you mind telling how does it works

waiting for your response

best regards

vikal acharya
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2009-03-22 18:59:01 <br />
@ Bjorn Roesbeke: I&#8217;ve added your testcase, but it succeeds. Are you sure you&#8217;re running the latest version?
<hr />


<strong>
<a href="http://www.bjornroesbeke.be" rel="nofollow">Bjorn Roesbeke</a>
</strong>
on 2009-03-04 21:53:40 <br />
F.e. a single quote with entity &amp;amp;#039; isn&#8217;t converted correctly.
<pre><code>htmlentities(&amp;quot;foo'bar&amp;quot;,&amp;quot;ENT_QUOTES&amp;quot;);</code></pre>
will return foo&amp;amp;amp;#039;
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-09-13 15:39:08 <br />
@ nobbler: Haha, ok, well still adding the var. Thank you!
<hr />


<strong>
nobbler
</strong>
on 2008-09-11 10:15:30 <br />
using &#8216;var i&#8217; instead of only &#8216;i&#8217; in the for loop could prevent from overwriting global &#8216;i&#8217;, even though no one should use it. But well, i did, and found another error on that way, so it kinda helpt me :)
<hr />


<strong>
Nietzsche&#8217;s Tears
</strong>
on 2008-05-15 22:22:57 <br />
Tested on Safari 3.1.1 and Firefox 2.0.0.14. Function fails to convert &amp;quot;copyright&amp;quot; and &amp;quot;registered&amp;quot; symbols to their equivalent HTML entities.
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-03-15 11:54:04 <br />
@ john: A new function, great! Thanks a lot john!
<hr />


<strong>
john
</strong>
on 2008-03-15 06:20:53 <br />
here is the reverse function 
(     html_entity_decode()    )

<pre><code>
function html_entity_decode(str) {
    //jd-tech.net
    var tarea=document.createElement('textarea');
        tarea.innerHTML = str; return tarea.value;
        tarea.parentNode.removeChild(tarea);
    }
</code></pre>
<hr />


</div>


  
    <footer>
      
      
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://phpjs.org/functions/htmlentities/index.html" data-via="phpjs" data-counturl="http://phpjs.org/functions/htmlentities/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Kevin van Zonneveld -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
   -
  <span class="credit">Theme by <a href="http://melandri.net/2012/07/23/darkstripes-octopress-theme-released/">alessandro melandri</a></span>
</p>
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'phpjs';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://phpjs.org/functions/htmlentities/index.html';
        var disqus_url = 'http://phpjs.org/functions/htmlentities/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
