
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>JavaScript serialize function - php.js</title>
  <meta name="author" content="Kevin van Zonneveld">

  
  <meta name="description" content="JavaScript serialize function A JavaScript equivalent of PHP&#8217;s serialize var/serialize.js raw on github 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://phpjs.org/functions/serialize/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="php.js" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-63083-7']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">php</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">.js</a></h1>
  
    <h2>A resource of php functions in JavaScript</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:phpjs.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Blog</a></li>
  <li><a href="/functions">Functions</a></li>
  <li><a href="/authors">Authors</a></li>
  <li><a target="_blank" href="https://github.com/kvz/phpjs/wiki/_pages">Wiki</a></li>
  <li><a target="_blank"  href="http://twitter.com/phpjs">@phpjs</a></li>
  <li><a target="_blank"  href="http://identi.ca/brettz9">@brettz9</a></li>
  <li><a target="_blank"  href="http://twitter.com/kvz">@kvz</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">JavaScript serialize function</h1>
    
  </header>
  
  <!-- Generated by Rakefile:build -->


<p>A JavaScript equivalent of PHP&#8217;s serialize</p>

<figure class='code'><figcaption><span>var/serialize.js </span><a href='https://raw.github.com/kvz/phpjs/master/functions/var/serialize.js'>raw on github </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">serialize</span> <span class="p">(</span><span class="nx">mixed_value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// http://kevin.vanzonneveld.net</span>
</span><span class='line'>  <span class="c1">// +   original by: Arpad Ray (mailto:arpad@php.net)</span>
</span><span class='line'>  <span class="c1">// +   improved by: Dino</span>
</span><span class='line'>  <span class="c1">// +   bugfixed by: Andrej Pavlovic</span>
</span><span class='line'>  <span class="c1">// +   bugfixed by: Garagoth</span>
</span><span class='line'>  <span class="c1">// +      input by: DtTvB (http://dt.in.th/2008-09-16.string-length-in-bytes.html)</span>
</span><span class='line'>  <span class="c1">// +   bugfixed by: Russell Walker (http://www.nbill.co.uk/)</span>
</span><span class='line'>  <span class="c1">// +   bugfixed by: Jamie Beck (http://www.terabit.ca/)</span>
</span><span class='line'>  <span class="c1">// +      input by: Martin (http://www.erlenwiese.de/)</span>
</span><span class='line'>  <span class="c1">// +   bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net/)</span>
</span><span class='line'>  <span class="c1">// +   improved by: Le Torbi (http://www.letorbi.de/)</span>
</span><span class='line'>  <span class="c1">// +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net/)</span>
</span><span class='line'>  <span class="c1">// +   bugfixed by: Ben (http://benblume.co.uk/)</span>
</span><span class='line'>  <span class="c1">// %          note: We feel the main purpose of this function should be to ease the transport of data between php &amp; js</span>
</span><span class='line'>  <span class="c1">// %          note: Aiming for PHP-compatibility, we have to translate objects to arrays</span>
</span><span class='line'>  <span class="c1">// *     example 1: serialize([&#39;Kevin&#39;, &#39;van&#39;, &#39;Zonneveld&#39;]);</span>
</span><span class='line'>  <span class="c1">// *     returns 1: &#39;a:3:{i:0;s:5:&quot;Kevin&quot;;i:1;s:3:&quot;van&quot;;i:2;s:9:&quot;Zonneveld&quot;;}&#39;</span>
</span><span class='line'>  <span class="c1">// *     example 2: serialize({firstName: &#39;Kevin&#39;, midName: &#39;van&#39;, surName: &#39;Zonneveld&#39;});</span>
</span><span class='line'>  <span class="c1">// *     returns 2: &#39;a:3:{s:9:&quot;firstName&quot;;s:5:&quot;Kevin&quot;;s:7:&quot;midName&quot;;s:3:&quot;van&quot;;s:7:&quot;surName&quot;;s:9:&quot;Zonneveld&quot;;}&#39;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">val</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">okey</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">ktype</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">vals</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">_utf8Size</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">l</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">code</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">&lt;</span> <span class="mh">0x0080</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">size</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">code</span> <span class="o">&lt;</span> <span class="mh">0x0800</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">size</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">size</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">size</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">_getType</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">inp</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">cons</span><span class="p">,</span> <span class="nx">types</span><span class="p">,</span> <span class="nx">type</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">inp</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">inp</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s1">&#39;null&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">inp</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="s1">&#39;object&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nx">cons</span> <span class="o">=</span> <span class="nx">inp</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">match</span> <span class="o">=</span> <span class="nx">cons</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/(\w+)\(/</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">cons</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nx">types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">];</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">types</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">cons</span> <span class="o">==</span> <span class="nx">types</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">type</span> <span class="o">=</span> <span class="nx">types</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">type</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">type</span> <span class="o">=</span> <span class="nx">_getType</span><span class="p">(</span><span class="nx">mixed_value</span><span class="p">)</span>
</span><span class='line'>  <span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;function&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;boolean&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;b:&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">mixed_value</span> <span class="o">?</span> <span class="s1">&#39;1&#39;</span> <span class="o">:</span> <span class="s1">&#39;0&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;number&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">val</span> <span class="o">=</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">mixed_value</span><span class="p">)</span> <span class="o">==</span> <span class="nx">mixed_value</span> <span class="o">?</span> <span class="s1">&#39;i&#39;</span> <span class="o">:</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">mixed_value</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;string&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;s:&#39;</span> <span class="o">+</span> <span class="nx">_utf8Size</span><span class="p">(</span><span class="nx">mixed_value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&quot;&#39;</span> <span class="o">+</span> <span class="nx">mixed_value</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;array&#39;</span><span class="o">:</span> <span class="k">case</span> <span class="s1">&#39;object&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">        if (type == &#39;object&#39;) {</span>
</span><span class='line'><span class="cm">          var objname = mixed_value.constructor.toString().match(/(\w+)\(\)/);</span>
</span><span class='line'><span class="cm">          if (objname == undefined) {</span>
</span><span class='line'><span class="cm">            return;</span>
</span><span class='line'><span class="cm">          }</span>
</span><span class='line'><span class="cm">          objname[1] = this.serialize(objname[1]);</span>
</span><span class='line'><span class="cm">          val = &#39;O&#39; + objname[1].substring(1, objname[1].length - 1);</span>
</span><span class='line'><span class="cm">        }</span>
</span><span class='line'><span class="cm">        */</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">mixed_value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">mixed_value</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">ktype</span> <span class="o">=</span> <span class="nx">_getType</span><span class="p">(</span><span class="nx">mixed_value</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">ktype</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="nx">okey</span> <span class="o">=</span> <span class="p">(</span><span class="nx">key</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[0-9]+$/</span><span class="p">)</span> <span class="o">?</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">:</span> <span class="nx">key</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">vals</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="nx">okey</span><span class="p">)</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="nx">mixed_value</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
</span><span class='line'>          <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">val</span> <span class="o">+=</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">count</span> <span class="o">+</span> <span class="s1">&#39;:{&#39;</span> <span class="o">+</span> <span class="nx">vals</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="s1">&#39;undefined&#39;</span><span class="o">:</span>
</span><span class='line'>      <span class="c1">// Fall-through</span>
</span><span class='line'>    <span class="k">default</span><span class="o">:</span>
</span><span class='line'>      <span class="c1">// if the JS object has a property which contains a null value, the string cannot be unserialized by PHP</span>
</span><span class='line'>      <span class="nx">val</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">!==</span> <span class="s1">&#39;array&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">val</span> <span class="o">+=</span> <span class="s1">&#39;;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://github.com/kvz/phpjs/blob/master/functions/var/serialize.js">view on github</a></li>
<li><a href="https://github.com/kvz/phpjs/edit/master/functions/var/serialize.js">edit on github</a></li>
</ul>


<h3>Example 1</h3>

<p>This code</p>

<figure class='code'><figcaption><span>example </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">serialize</span><span class="p">([</span><span class="s1">&#39;Kevin&#39;</span><span class="p">,</span> <span class="s1">&#39;van&#39;</span><span class="p">,</span> <span class="s1">&#39;Zonneveld&#39;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Should return</p>

<figure class='code'><figcaption><span>returns </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s1">&#39;a:3:{i:0;s:5:&quot;Kevin&quot;;i:1;s:3:&quot;van&quot;;i:2;s:9:&quot;Zonneveld&quot;;}&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Example 2</h3>

<p>This code</p>

<figure class='code'><figcaption><span>example </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">serialize</span><span class="p">({</span><span class="nx">firstName</span><span class="o">:</span> <span class="s1">&#39;Kevin&#39;</span><span class="p">,</span> <span class="nx">midName</span><span class="o">:</span> <span class="s1">&#39;van&#39;</span><span class="p">,</span> <span class="nx">surName</span><span class="o">:</span> <span class="s1">&#39;Zonneveld&#39;</span><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Should return</p>

<figure class='code'><figcaption><span>returns </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s1">&#39;a:3:{s:9:&quot;firstName&quot;;s:5:&quot;Kevin&quot;;s:7:&quot;midName&quot;;s:3:&quot;van&quot;;s:7:&quot;surName&quot;;s:9:&quot;Zonneveld&quot;;}&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Other PHP functions in the var extension</h3>

<!-- Generated by Rakefile:build -->


<ul>
<li><a href="/functions/doubleval">doubleval</a></li>
<li><a href="/functions/empty">empty</a></li>
<li><a href="/functions/floatval">floatval</a></li>
<li><a href="/functions/get_defined_vars">get_defined_vars</a></li>
<li><a href="/functions/get_resource_type">get_resource_type</a></li>
<li><a href="/functions/gettype">gettype</a></li>
<li><a href="/functions/import_request_variables">import_request_variables</a></li>
<li><a href="/functions/intval">intval</a></li>
<li><a href="/functions/is_array">is_array</a></li>
<li><a href="/functions/is_binary">is_binary</a></li>
<li><a href="/functions/is_bool">is_bool</a></li>
<li><a href="/functions/is_buffer">is_buffer</a></li>
<li><a href="/functions/is_callable">is_callable</a></li>
<li><a href="/functions/is_double">is_double</a></li>
<li><a href="/functions/is_float">is_float</a></li>
<li><a href="/functions/is_int">is_int</a></li>
<li><a href="/functions/is_integer">is_integer</a></li>
<li><a href="/functions/is_long">is_long</a></li>
<li><a href="/functions/is_null">is_null</a></li>
<li><a href="/functions/is_numeric">is_numeric</a></li>
<li><a href="/functions/is_object">is_object</a></li>
<li><a href="/functions/is_real">is_real</a></li>
<li><a href="/functions/is_resource">is_resource</a></li>
<li><a href="/functions/is_scalar">is_scalar</a></li>
<li><a href="/functions/is_string">is_string</a></li>
<li><a href="/functions/is_unicode">is_unicode</a></li>
<li><a href="/functions/isset">isset</a></li>
<li><a href="/functions/print_r">print_r</a></li>
<li><a href="/functions/serialize">serialize</a></li>
<li><a href="/functions/settype">settype</a></li>
<li><a href="/functions/strval">strval</a></li>
<li><a href="/functions/unserialize">unserialize</a></li>
<li><a href="/functions/var_dump">var_dump</a></li>
<li><a href="/functions/var_export">var_export</a></li>
</ul>


<h2>Legacy comments</h2>

<p>These were imported from our old site. Please use disqus below for new comments</p>

<div style="overflow-y: scroll; max-height: 500px;">
<!-- Generated by Rakefile:build -->

<strong>
Rick K
</strong>
on 2012-08-01 00:19:17 <br />
So I&#8217;m not really sure whats going on here, but I&#8217;m having a problem with this function. When I use PHP&#8217;s serialize on a string value of &quot;7&amp;frac12;&quot; (imagine the html entity here is the actual 1/2 fraction character and not the html entity code (not sure if it will render or not at time of posting)) The php parser will return a string value 2 bytes long. When I do the same via JS and this function, I get a string value 3 bytes long with a hidden &amp;Acirc character between 7 and the 1/2 fraction. Why is this? I&#8217;ve tried everything to get around it. What I ended up having to do was in php, after it receives the serialized version of the string, it unserializes it, then it runs it through a recursive function that essentially converts all special characters to their &amp;entityName; code, then I  str_ireplace(&quot;&amp;Acirc;&quot;, &quot;&quot;, $curval); then I reencode the value by converting all &amp;entities; back to ther actual character code. Then I re-serialize using php&#8217;s serialize function and then store it to the database. Case and point when I reserialized this via PHP with the 1/2 fraction characater (as a character) in the string, it stores it correctly as a 2 byte string and does not add the funky acric character back in. This was the ONLY way I could get this function to work. I know the Acirc character has something to do with character encoding but the site is set to use western/latin, not UTF8. Is there some way via javascript I can convert the UTF8 version of the value to the latin version before I use your serialize function? 

And why does this function not work exactly like the PHP version? I thought that was the point of this project? Is this a bug?

<pre><code>
Here is your functions version:
a:1:{i:0;a:7:{s:3:&quot;sku&quot;;s:5:&quot;1052m&quot;;s:4:&quot;name&quot;;s:21:&quot;Boonie Hat (ABU Camo)&quot;;s:5:&quot;price&quot;;s:5:&quot;17.99&quot;;s:3:&quot;qty&quot;;s:1:&quot;1&quot;;s:6:&quot;typeid&quot;;s:1:&quot;3&quot;;s:6:&quot;status&quot;;s:3:&quot;new&quot;;s:2:&quot;ui&quot;;a:1:{i:0;a:2:{s:4:&quot;name&quot;;s:4:&quot;size&quot;;s:5:&quot;value&quot;;s:3:&quot;7½&quot;;}}}}

(notice s:3: on the last value of the last array)

Here is PHP's version:
a:1:{i:0;a:7:{s:3:&quot;sku&quot;;s:5:&quot;1052m&quot;;s:4:&quot;name&quot;;s:21:&quot;Boonie Hat (ABU Camo)&quot;;s:5:&quot;price&quot;;s:5:&quot;17.99&quot;;s:3:&quot;qty&quot;;d:1;s:6:&quot;typeid&quot;;s:1:&quot;3&quot;;s:6:&quot;status&quot;;s:3:&quot;new&quot;;s:2:&quot;ui&quot;;a:1:{i:0;a:2:{s:4:&quot;name&quot;;s:4:&quot;size&quot;;s:5:&quot;value&quot;;s:2:&quot;7½&quot;;}}}

(notice s:2: on the last value of the last array)
</code></pre>
<hr />


<strong>
<a href="http://brett-zamir.me" rel="nofollow">Brett Zamir</a>
</strong>
on 2012-06-16 07:34:06 <br />
@jj: Care to prepare a test case?
<hr />


<strong>
jj
</strong>
on 2012-02-12 15:42:08 <br />
this peace of shit is not working.
<hr />


<strong>
<a href="http://www.constantconceptions.com" rel="nofollow">Cody O&#8217;Dell</a>
</strong>
on 2011-01-24 23:08:20 <br />
Is there a way to get this working with apostrophes?
<hr />


<strong>
<a href="http://brett-zamir.me" rel="nofollow">Brett Zamir</a>
</strong>
on 2011-01-09 13:43:07 <br />
@Vadim: Yes, thank you. The cache is still stale, but in Git it has been updated for a while: https://github.com/kvz/phpjs/raw/master/functions/var/serialize.js
<hr />


<strong>
Vadim
</strong>
on 2011-01-09 00:12:29 <br />
In &quot;var _utf8Size = function (str)&quot;:

This woun&#8217;t work in IE6:
<pre><code>code = str[i].charCodeAt(0);</code></pre>

This work fine (thanks to Ben 10 NOV&#8217;10):
<pre><code>code = str.charCodeAt(i);</code></pre>
<hr />


<strong>
<a href="http://brett-zamir.me" rel="nofollow">Brett Zamir</a>
</strong>
on 2010-11-10 11:12:04 <br />
@Ben: Thanks! Fixed in Git&#8230;
<hr />


<strong>
<a href="benblume.co.uk" rel="nofollow">Ben</a>
</strong>
on 2010-11-10 10:24:27 <br />
I have been working with this code on a project and found some non-compatibility with IE.

On line 27, the code relies on the str[i] notation to access a character from a string. This does not work in IE, resulting in an undefined value that breaks the rest of the function. See http://en.wikipedia.org/wiki/JavaScript_syntax#String for confirmation of this.

A better option would be either:

<pre><code>
var code = str.charCodeAt(i);
</code></pre>

or

<pre><code>
var code = str.chartAt(i).charCodeAt(0);
</code></pre>
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2010-09-08 19:31:16 <br />
@ Fadil Kujundzic: That section is commented out. Are you using an older version of serialize?

@ Le Torbi: Thanks a lot! Fixed: https://github.com/kvz/phpjs/commit/d98ce0a441e4d6f45a5fddb8cf066f8d1a569e65
Your contrib will soon show up on the site as well.
<hr />


<strong>
Fadil Kujundzic
</strong>
on 2010-08-12 15:53:14 <br />
I had a problem with serialize function objects were stored as array. To fix this I changed at line 73 <pre><code> objname [1] this.serialize (= objname [1 ]);[/ CODE] to <pre><code> objname [1] this.serialize (= objname [1] == &quot;Object [&quot; ? &quot;stdClass&quot;: objname [1 ]);[/ CODE]. Maybe might be useful for someone.
<hr />


<strong>
<a href="http://www.letorbi.de" rel="nofollow">Le Torbi</a>
</strong>
on 2009-09-26 18:01:29 <br />
Hi there,

when fixing the UTF-8 issue of the unserialize() function I've found a way to improve the speed of the size calculation for strings. It's quite simple and need no complex string operations or regular expressions. Here is the code:

<pre><code>
var utf8Size = function(str) { // NEW FUNCTION
    var size = 0;
    for (var i = 0; i &lt; str.length; i++) {
        var code = str[i].charCodeAt(0);
        if (code &lt; 0x0080)
            size += 1;
        else if (code &lt; 0x0800)
            size += 2;
        else
        size += 3;
    }
    return size;
}
var _getType = function (inp) {
    var type = typeof inp, match;
    var key;
// MORE LINES OF CODE
        val = (Math.round(mixed_value) == mixed_value ? &quot;i&quot; : &quot;d&quot;) + &quot;:&quot; + mixed_value;
        break;
    case &quot;string&quot;:
        val = &quot;s:&quot; + utf8Size(mixed_value) + &quot;:\&quot;&quot; + mixed_value + &quot;\&quot;&quot;; // MODIFIED LINE
        break;
 case &quot;array&quot;:
case &quot;object&quot;:
</code></pre>

I&#8217;ve made some simple test and it seems that my function needs about 0.0004ms per run, while the old needs 0.004ms. Ok, it&#8217;s not much, but maybe worth the code anyway&#8230;

BTW: What do I have to to to get this into the official code?

Bai
Le Torbi
<hr />


<strong>
<a href="http://brett-zamir.me" rel="nofollow">Brett Zamir</a>
</strong>
on 2009-08-19 16:19:52 <br />
@Russell Walker: That sounds good, but can you please confirm that this is in fact the same behavior in PHP?
<hr />


<strong>
<a href="http://www.nbill.co.uk/" rel="nofollow">Russell Walker</a>
</strong>
on 2009-08-18 15:21:53 <br />
When serializing strings that contain URL entities (such as the plus symbol), they were being lost during unserialization in PHP. To fix this, I changed line 58 to URIEncode the string value like this:

<pre><code>
val = &quot;s:&quot; + encodeURIComponent(mixed_value).replace(/%../g, 'x').length + &quot;:\&quot;&quot; + encodeURIComponent(mixed_value) + &quot;\&quot;&quot;;
</code></pre>
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2009-08-16 15:23:40 <br />
@ Alexandre Felipe Muller: Thanks for sharing. It&#8217;s gonna take a while to investigate it and strip it of your environment&#8217;s specific dependencies like showMessage(Element(&#8216;cc_msg_err_serialize_data_unknown&#8217;).value);
If after that all the testcases pass and they&#8217;re indeed faster I will replace the current implementations with your&#8217;s
<hr />


<strong>
<a href="www.expressolivre.net" rel="nofollow">Alexandre Felipe Muller</a>
</strong>
on 2009-08-05 14:07:15 <br />
We&#8217;re using my serialize and unserialize in my project for 3 years, acording to my tests it&#8217;s 3 or 4 times faster. Who want to see
<pre><code>
    cConnector.prototype.serialize = function(data)
    {   var _thisObject = this;     
        var f = function(data)
        {
            var str_data;
    
            if (data == null || 
                (typeof(data) == 'string' &amp;&amp; data == ''))
            {
                str_data = 'N;';
            }
    
            else switch(typeof(data))
            {
                case 'object':
                    var arrayCount = 0;
    
                    str_data = '';
    
                    for (i in data)
                    {
                        if (i == 'length')
                        {
                            continue;
                        }
                        
                        arrayCount++;
                        switch (typeof(i))
                        {
                            case 'number':
                                str_data += 'i:' + i + ';' + f(data[i]);
                                break;
    
                            case 'string':
                                str_data += 's:' + i.length + ':&quot;' + i + '&quot;;' + f(data[i]);
                                break;
    
                            default:
                                showMessage(Element('cc_msg_err_serialize_data_unknown').value);
                                break;
                        }
                    }
    
                    if (!arrayCount)
                    {
                        str_data = 'N;';    
                    }
                    else
                    {
                        str_data = 'a:' + arrayCount + ':{' + str_data + '}';
                    }
                    
                    break;
            
                case 'string':
                    str_data = 's:' + data.length + ':&quot;' + data + '&quot;;';
                    break;
                    
                case 'number':
                    str_data = 'i:' + data + ';';
                    break;
    
                case 'boolean':
                    str_data = 'b:' + (data ? '1' : '0') + ';';
                    break;
    
                default:
                    showMessage(Element('cc_msg_err_serialize_data_unknown').value);
                    return null;
            }

            return str_data;
        }
    
        return f(data);
    }
    //Unserialize Data Method
    cConnector.prototype.unserialize = function(str)
    {
        _thisObject = this;
        var matchB = function (str, iniPos)
        {
            var nOpen, nClose = iniPos;
            do
            {
                nOpen = str.indexOf('{', nClose+1);
                nClose = str.indexOf('}', nClose+1);

                if (nOpen == -1)
                {
                    return nClose;
                }
                if (nOpen &lt; nClose )
                {
                    nClose = matchB(str, nOpen);
                }
            } while (nOpen &lt; nClose);

            return nClose;
        }

        var f = function (str)
        {
            switch (str.charAt(0))
            {
                case 'a':
                    var data = new Array();
                    var n = parseInt( str.substring(str.indexOf(':')+1, str.indexOf(':',2) ) );
                    var arrayContent = str.substring(str.indexOf('{')+1, str.lastIndexOf('}'));
                    for (var i = 0; i &lt; n; i++)
                    {
                        var pos = 0;
    
                        /* Process Index */
                        var indexStr = arrayContent.substr(pos, arrayContent.indexOf(';')+1);
                        var index = f(indexStr);
                        pos = arrayContent.indexOf(';', pos)+1;
                        
                        /* Process Content */
                        var part = null;
                        switch (arrayContent.charAt(pos))
                        {
                            case 'a':
                                var pos_ = matchB(arrayContent, arrayContent.indexOf('{', pos))+1;
                                part = arrayContent.substring(pos, pos_);
                                pos = pos_;
                                data[index] = f(part);
                                break;
                        
                            case 's':
                                var pval = arrayContent.indexOf(':', pos+2);
                                var val  = parseInt(arrayContent.substring(pos+2, pval));
                                pos = pval + val + 4;
                                data[index] = arrayContent.substr(pval+2, val);
                                break;
    
                            default:
                                part = arrayContent.substring(pos, arrayContent.indexOf(';', pos)+1);
                                pos = arrayContent.indexOf(';', pos)+1;
                                data[index] = f(part);
                                break;
                        }
                        arrayContent = arrayContent.substr(pos);
                    }
                    break;
                    
                case 's':
                    var pos = str.indexOf(':', 2);
                    var val = parseInt(str.substring(2,pos));
                    var data = str.substr(pos+2, val);
                    str = str.substr(pos + 4 + val);
                    break;
    
                case 'i':
                case 'd':
                    var pos = str.indexOf(';');
                    var data = parseInt(str.substring(2,pos));
                    str = str.substr(pos + 1);
                    break;
                
                case 'N':
                    var data = null;
                    str = str.substr(str.indexOf(';') + 1);
                    break;
    
                case 'b':
                    var data = str.charAt(2) == '1' ? true : false;
                    break;
            }
            return data;
        }
    
        return f(str);
    }

</code></pre>
<hr />


<strong>
<a href="http://brett-zamir.me" rel="nofollow">Brett Zamir</a>
</strong>
on 2009-08-03 20:55:22 <br />
@Jamie: Fixed in SVN. Thanks for the report!
<hr />


<strong>
<a href="http://www.terabit.ca" rel="nofollow">Jamie Beck</a>
</strong>
on 2009-08-03 17:48:17 <br />
Should not lines 83-84 be as follows for the namespaced version. Otherwise the function cannot be found&#8230;

<pre><code>
vals += this.serialize(okey) +
    this.serialize(mixed_value[key]);
</code></pre>
<hr />


<strong>
<a href="http://bahai-library.com" rel="nofollow">Brett Zamir</a>
</strong>
on 2009-06-18 07:20:25 <br />
Fixed in SVN! Thanks! (also added your website to the credit)
<hr />


<strong>
<a href="http://www.nbill.co.uk/" rel="nofollow">Russell Walker</a>
</strong>
on 2009-06-16 12:33:11 <br />
I found that if the javascript object has a property which contains a null value, the string cannot be unserialized by PHP. To fix this, I added:

<pre><code>
default:
  val = &quot;N&quot;;
  break;
</code></pre>

&#8230;to the end of the switch block (around line 92 on the above function). The &#8216;undefined&#8217; case should probably be moved down to the bottom as well so both can be handled together, ie:

<pre><code>
case 'undefined':
default:
  val = &quot;N&quot;;
  break;
</code></pre>
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2009-05-31 20:01:37 <br />
@ Russell Walker: Thanks for contributing. I&#8217;ve implemented your fix in svn &amp; it will be available shortly.
http://trac.plutonia.nl/projects/phpjs/browser/trunk/functions/var/serialize.js
<hr />


<strong>
<a href="www.nbill.co.uk" rel="nofollow">Russell Walker</a>
</strong>
on 2009-05-30 16:48:50 <br />
Sorry, I quoted the line number from my own file, but in php.default.js, it is line 5826.
<hr />


<strong>
<a href="www.nbill.co.uk" rel="nofollow">Russell Walker</a>
</strong>
on 2009-05-30 16:45:47 <br />
I found that when serializing utf-8 characters that differ from iso-8859-1, the string could not be deserialized by PHP. This is because PHP sees the string as containing more characters than it really does (as it thinks 1 character = 1 byte, when unicode characters can take up more than 1 byte). So I amended the code on line 97 from

<pre><code>val = &quot;s:&quot; + mixed_value.length + &quot;:\&quot;&quot; + mixed_value + &quot;\&quot;&quot;;</code></pre>

to

<pre><code>val = &quot;s:&quot; + encodeURIComponent(mixed_value).replace(/%../g, 'x').length + &quot;:\&quot;&quot; + mixed_value + &quot;\&quot;&quot;;</code></pre>

&#8230;so now it serializes utf-8 characters in a way that PHP can deserialize. Note however, that this will probably break the javascript unserialize function, as JS and PHP cannot agree on the number of characters in the string.

The code to get the length of the string in bytes came from DtTvB: http://dt.in.th/2008-09-16.string-length-in-bytes.html
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2009-05-12 15:39:06 <br />
@ AndreaZ: Thx for the pastebin, this makes it clear to me what&#8217;s going wrong. You are stripping slashes before you are unserializing the string, while escaped characters are an essential part of of the serialized object.

To circumvent, remove stripslashes, or first use base64_encode over the serialized object, and then in php decode it.
<hr />


<strong>
AndreaZ
</strong>
on 2009-05-01 11:23:29 <br />
@Kevin: http://pastebin.com/m7f1e9ef0
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2009-04-29 15:22:04 <br />
@ AndreaZ: Why don&#8217;t you put it in pastebin.org, and add a link here. then we have syntax highlighting as well. Thanx!
<hr />


<strong>
AndreaZ
</strong>
on 2009-04-25 10:35:19 <br />
@Kevin: i inserted the code inside <pre><code></code></pre> but it seems that i wrong something :-(

send me an email, so i can send you the test file
<hr />


<strong>
AndreaZ
</strong>
on 2009-04-25 10:31:55 <br />
@Kevin: that&#8217;s the test code
<pre><code>
&lt;html&gt;
&lt;body&gt;
&lt;?php
if (isset($_POST['foo']))
    {
        error_reporting(E_ALL);
        $ar = $_POST['foo'];
        var_dump($ar).'&lt;br/&gt;';
        $ser=stripslashes($ar);
        var_dump($ser).'&lt;br/&gt;';
        $unser = unserialize($ser);
        var_dump($unser).'&lt;br/&gt;';
    }
?&gt;
&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;
&lt;!--
function clicca() {
    document.adminForm.foo.value = serialize(document.adminForm.foo.value);
}

function serialize( mixed_value ) {
    /* your function */
}
//--&gt;
&lt;/script&gt;

&lt;form action=&quot;try_serialize.php&quot; method=&quot;post&quot; name=&quot;adminForm&quot;&gt;
&lt;textarea id=&quot;foo&quot; name=&quot;foo&quot;&gt;
a textarea with
newline&lt;/textarea&gt;
&lt;br /&gt;
&lt;button type=&quot;sumbit&quot; onclick=&quot;clicca();&quot;&gt;Send&lt;/button&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2009-04-20 20:07:24 <br />
@ AndreaZ: Ok if you put the PHP-serialized string inside codeblocks here, I can unserialize it with PHP as well, and then test serializing it with JS.

So if you could provide me with that data that would help me a lot. thx
<hr />


<strong>
AndreaZ
</strong>
on 2009-04-20 13:46:16 <br />
@Kevin: i serialized a multidimensional array with your javascript function, then i unserialized the result inside a php file: unserialize returns false (if i serialize with php it works)

how can i send to you the test that i made? it is a little php file with inside your javascript serialize function

PS: thanks a lot for your work ;-)
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2009-04-20 00:04:47 <br />
@ AndreaZ: I did some testing with the following code:
<pre><code>
$ser = serialize(&quot;a \n b&quot;);
var_dump($ser);
</code></pre>
.. which is executable by both PHP &amp; JS. 
Both return the exact same output:
<pre><code>
kevin@kevin-desktop:~/workspace/plutonia-phpjs/_tools$ rhino debug.js 
string(12) &quot;s:5:&quot;a 
 b&quot;;&quot;
kevin@kevin-desktop:~/workspace/plutonia-phpjs/_tools$ php debug.php
string(12) &quot;s:5:&quot;a 
 b&quot;;&quot;
</code></pre>

..so I&#8217;m wondering could it be that something else is buggy in the script you are using? If not, can you supply the full input and code that gives the wrong results?
<hr />


<strong>
AndreaZ
</strong>
on 2009-04-19 12:20:02 <br />
when there&#8217;s a newline character (\n) inside a serialized string, php unseriliaze returns false

i don&#8217;t know why :-(
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2009-03-22 19:07:54 <br />
@ Thomas: You&#8217;re the first to report. Would it be possible for you to supply test-data?
<hr />


<strong>
<a href="www.cyber-nova.com" rel="nofollow">Thomas</a>
</strong>
on 2009-03-08 19:32:50 <br />
Works fine with php 5.2.0.
But doesn&#8217;t work with php 5.2.6 ! Php cannot unserialize the string.

Any known issues about this ?
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-12-30 10:28:17 <br />
@ Garagoth: Well noticed. That doesn&#8217;t make any sense at all.
<hr />


<strong>
Garagoth
</strong>
on 2008-12-18 17:04:45 <br />
Hm, an interesting line of code, not sure how it is supposed to work:

<pre><code>
if (ktype == &amp;quot;function&amp;quot; &amp;amp;&amp;amp; ktype == &amp;quot;object&amp;quot;) {
    continue; 
}
</code></pre>

Cheers,
Garagoth.
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-12-01 08:46:19 <br />
@ Andrej Pavlovic: Thanks man!
<hr />


<strong>
Tom
</strong>
on 2008-11-27 18:33:36 <br />
The returned representation of provided function is valid PHP code (which is correct).
But does anyone have a JS var_export function whose returned representation is valid javascript code?
The returned value type should be string and it could be passed to eval() function.
Examples:
<pre><code>
var a = new Array(12, '13', 'abc', 'line1\nline2\nline3');
var js_code = var_export(a);
/*
the returned value should be:
&quot;{0:12, 1:'13', 2:'abc', 3:'line1\nline2\nline3'}&quot;
*/

var b = {'key1':4, 'key2':'5', 'key3':'xxx\n123', 555:'text'};
js_code = var_export(b);
/*
the returned value should be:
&quot;{'key1':4, 'key2':'5', 'key3':'xxx\n123', 555:'text'}&quot;
*/

var c = 123;
js_code = var_export(c); // &quot;123&quot;

var d = '321';
js_code = var_export(d); // &quot;'321'&quot;

var e = 'multilne\ntext';
js_code = var_export(e); // &quot;'multiline\ntext'&quot;

function add(x, y)
{
      res = x + y;
      return res;
}
var js_code = var_export(add);
/*
the returned value should be:
&quot;function add(x, y) { res = x + y; return res; }&quot;
*/
</code></pre>

Thanks.
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-09-21 21:57:28 <br />
@ Dino: I&#8217;ve committed your changes! Thank you.
<hr />


<strong>
mopont
</strong>
on 2008-09-19 09:42:17 <br />
Great function!
<hr />


<strong>
<a href="www.pushideas.com" rel="nofollow">dino</a>
</strong>
on 2008-09-19 09:40:50 <br />
woops I don&#8217;t think my code showed up properly.

<pre><code>
for (key in mixed_value) {
        var ktype = _getType(mixed_value[key]);
        
        //alert(key + ' type is ' + ktype);
        if (ktype != &amp;quot;function&amp;quot; &amp;amp;&amp;amp; ktype != &amp;quot;object&amp;quot;) {
            okey = (key.match(/^[0-9]+$/) ? parseInt(key) : key);
            vals += serialize(okey) +
                serialize(mixed_value[key]);
            count++;
        }
            }
</code></pre>
<hr />


<strong>
<a href="www.pushideas.com" rel="nofollow">dino</a>
</strong>
on 2008-09-19 09:39:29 <br />
serialize doesn&#8217;t work well with mootools since mootools adds or extends the array object with functions which serialize picks up on and tries to translate into a string.

At least it broke my code when I included mootools.

I fixed it by having serialize not try to translate objects or functions. It doesn&#8217;t seem like functions are being handled anyway.



<pre><code>
       case &amp;quot;function&amp;quot;:
        val = &amp;quot;&amp;quot;;
        break;

for (key in mixed_value) {
        var ktype = _getType(mixed_value[key]);
        
        //alert(key + ' type is ' + ktype);
        if (ktype != &amp;quot;function&amp;quot; &amp;amp;&amp;amp; ktype != &amp;quot;object&amp;quot;) {
            okey = (key.match(/^[0-9]+$/) ? parseInt(key) : key);
            vals += serialize(okey) +
                serialize(mixed_value[key]);
            count++;
        }
            }
<hr />


<strong>
Ren
</strong>
on 2008-09-09 13:53:23 <br />
Sorry plz, it was my fault. 
I used htmlspecialchars($_REQUEST), so the variable with serialized string encoded too. 
Function works fine :) thx
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-09-09 13:37:02 <br />
@ Ren: Can you please provide a print_r of the array in CODE blocks that you are trying to serialize? We need your import to improve this function. Thanks!
<hr />


<strong>
Thomas Buschhardt
</strong>
on 2008-09-09 13:24:10 <br />
Hallo, thanx for the code. How can I find out in the returned object the length of the arrays (if these arrays be)?
<hr />


<strong>
d3x
</strong>
on 2008-05-31 15:31:00 <br />
@ Kevin: Arpad Ray's implementation uses &amp;quot;eval&amp;quot; and &amp;quot;eval is evil&amp;quot;(http://blogs.msdn.com/ericlippert/archive/2003/11/01/53329.aspx)
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-05-31 14:21:01 <br />
@ d3x: Do you think that this function beats Arpad Ray's implementation?
<hr />


<strong>
d3x
</strong>
on 2008-05-30 22:51:03 <br />
For every other person that needs an unserialize implementation:

<pre><code>
function unserialize(data){
    function error(type, msg, filename, line){throw new window[type](msg, filename, line);}
    function read_until(data, offset, stopchar){
        var buf = [];
        var char = data.slice(offset, offset + 1);
        var i = 2;
        while(char != stopchar){
            if((i+offset) &amp;gt; data.length){
                error('Error', 'Invalid');
            }
            buf.push(char);
            char = data.slice(offset + (i - 1),offset + i);
            i += 1;
        }
        return [buf.length, buf.join('')];
    };
    function read_chars(data, offset, length){
        buf = [];
        for(var i = 0;i &amp;lt; length;i++){
            var char = data.slice(offset + (i - 1),offset + i);
            buf.push(char);
        }
        return [buf.length, buf.join('')];
    };
    function _unserialize(data, offset){
        if(!offset) offset = 0;
        var buf = [];
        var dtype = (data.slice(offset, offset + 1)).toLowerCase();
        
        var dataoffset = offset + 2;
        var typeconvert = new Function('x', 'return x');
        var chars = 0;
        var datalength = 0;
        
        switch(dtype){
            case &amp;quot;i&amp;quot;:
                typeconvert = new Function('x', 'return parseInt(x)');
                var readData = read_until(data, dataoffset, ';');
                var chars = readData[0];
                var readdata = readData[1];
                dataoffset += chars + 1;
            break;
            case &amp;quot;b&amp;quot;:
                typeconvert = new Function('x', 'return (parseInt(x) == 1)');
                var readData = read_until(data, dataoffset, ';');
                var chars = readData[0];
                var readdata = readData[1];
                dataoffset += chars + 1;
            break;
            case &amp;quot;d&amp;quot;:
                typeconvert = new Function('x', 'return parseFloat(x)');
                var readData = read_until(data, dataoffset, ';');
                var chars = readData[0];
                var readdata = readData[1];
                dataoffset += chars + 1;
            break;
            case &amp;quot;n&amp;quot;:
                readdata = null;
            break;
            case &amp;quot;s&amp;quot;:
                var ccount = read_until(data, dataoffset, ':');
                var chars = ccount[0];
                var stringlength = ccount[1];
                dataoffset += chars + 2;
                
                var readData = read_chars(data, dataoffset+1, parseInt(stringlength));
                var chars = readData[0];
                var readdata = readData[1];
                dataoffset += chars + 2;
                if(chars != parseInt(stringlength) &amp;amp;&amp;amp; chars != readdata.length){
                    error('SyntaxError', 'String length mismatch');
                }
            break;
            case &amp;quot;a&amp;quot;:
                var readdata = {};
                
                var keyandchars = read_until(data, dataoffset, ':');
                var chars = keyandchars[0];
                var keys = keyandchars[1];
                dataoffset += chars + 2;
                
                for(var i = 0;i &amp;lt; parseInt(keys);i++){
                    var kprops = _unserialize(data, dataoffset);
                    var kchars = kprops[1];
                    var key = kprops[2];
                    dataoffset += kchars;
                    
                    var vprops = _unserialize(data, dataoffset);
                    var vchars = vprops[1];
                    var value = vprops[2];
                    dataoffset += vchars;
                    
                    readdata[key] = value;
                }
                
                dataoffset += 1;
            break;
            default:
                error('SyntaxError', 'Unknown / Unhandled data type(s): ' + dtype);
            break;
        }
        return [dtype, dataoffset - offset, typeconvert(readdata)];
    };
    return _unserialize(data, 0)[2];
}
</code></pre>

Code translated from: http://hurring.com/scott/code/python/serialize/
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-03-02 19:38:56 <br />
@ Andrea Giammarchi: Impressive code Andrea! I will look into this and if I use (parts of) it, I will credit you accordingly! Thanks
<hr />


<strong>
Andrea Giammarchi
</strong>
on 2008-03-02 18:57:30 <br />
two years ago, 15.000 users, about zero problems:
http://www.devpro.it/javascript_id_102.html

It&#8217;s able to save correctly UTF-8 strings as well.

Cheers
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-03-02 16:21:13 <br />
@ Doug: About unserialize, just now I found a very good javascript unserialize function by Arpad Ray. I&#8217;ve included the function in this project. If Arpad doesn&#8217;t approve however (I&#8217;ve sent him an email), we will still have to write it ourselves.
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-02-28 23:53:59 <br />
@ Doug: Not yet, so feel free!
<hr />


<strong>
Doug
</strong>
on 2008-02-28 23:35:36 <br />
Have you started to compile a function for unserialize yet?
<hr />


<strong>
Franck Chionna
</strong>
on 2008-02-20 16:24:27 <br />
hello,

i d like to serialize a window object by a js var that contain window.open , thus to keep in memory the window open if the php page is refreshed. i tried to use your code but it says js error &amp;quot;too much recursion&#8230; any suggestion ? thanks and congratulation for the work done
<hr />


<strong>
Ates Goral
</strong>
on 2008-01-23 14:57:46 <br />
I&#8217;ll take a look at why serialize() is looping.
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-01-23 08:33:03 <br />
@ Ates Goral: Example 14 is giving: too much recursion after implementing the new get_class function in serialize
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-01-23 08:11:30 <br />
@ Ates Goral: Works like a charm, I will build this in serialize and add it as a dependency.

About your php-strict/javascript-flexible question. I think we should stay with PHP as close as possible. Hopefully this will provide consistency &amp;amp; clarity for end users. And interoperability between php-js-function throughout the project. This approach should also ensure that no extra function documentation has to be written because PHP&#8217;s function manual will (in most cases) be valid.
<hr />


<strong>
Ates Goral
</strong>
on 2008-01-22 22:39:36 <br />
Here&#8217;s get_class(). I think serialize() now can re-use this one instead of the local getObjectClass() implementation.

I&#8217;ve added the extra instanceof checks solely to match PHP behaviour. They can be removed since JavaScript has no problem with getting class names for simple types or arrays/functions etc. This brings up the question: Are we trying to mimic PHP behaviour as closely as possible or is it all right to introduce additional functionality brought forth by the flexibility of JavaScript?

<pre><code>
function get_class(obj) {
    // *     example 1: get_class(new (function MyClass() {}));
    // *     returns 1: &amp;quot;MyClass&amp;quot;
    // *     example 2: get_class({});
    // *     returns 2: &amp;quot;Object&amp;quot;
    // *     example 3: get_class([]);
    // *     returns 3: false
    // *     example 4: get_class(42);
    // *     returns 4: false
    // *     example 5: get_class(window);
    // *     returns 5: false
    // *     example 6: get_class(function MyFunction() {});
    // *     returns 6: false
    
    if (obj instanceof Object &amp;amp;&amp;amp; !(obj instanceof Array) &amp;amp;&amp;amp;
            !(obj instanceof Function) &amp;amp;&amp;amp; obj.constructor) {
        var arr = obj.constructor.toString().match(/function\s*(\w+)/);

        if (arr &amp;amp;&amp;amp; arr.length == 2) {
            return arr[1];
        }
    }
    
    return false;
}
</code></pre>
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-01-22 07:47:11 <br />
@ Ates Goral: Thanks, I&#8217;ve updated the function.
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-01-21 19:11:35 <br />
@ uestla: Yes it probably should :) Fixed, thank you!
<hr />


<strong>
Ates Goral
</strong>
on 2008-01-21 19:08:39 <br />
Hi Kevin,

Here are a few improvements to what I originally had:

For Array detection, instead of:

<pre><code>(&amp;quot;length&amp;quot; in mixed_val)</code></pre>

it&#8217;s nicer to say:

<pre><code>(mixed_val instanceof Array)</code></pre>

Also, an additional check can be added to handle the NaN and Infinite values:

<pre><code>
   case &amp;quot;number&amp;quot;:
        if (mixed_val == NaN || mixed_val == Infinity)
        {
            return false;
        }
        ...
</code></pre>
<hr />


</div>


  
    <footer>
      
      
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://phpjs.org/functions/serialize/index.html" data-via="phpjs" data-counturl="http://phpjs.org/functions/serialize/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Kevin van Zonneveld -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
   -
  <span class="credit">Theme by <a href="http://melandri.net/2012/07/23/darkstripes-octopress-theme-released/">alessandro melandri</a></span>
</p>
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'phpjs';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://phpjs.org/functions/serialize/index.html';
        var disqus_url = 'http://phpjs.org/functions/serialize/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
