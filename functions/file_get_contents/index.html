
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>JavaScript file_get_contents function - php.js</title>
  <meta name="author" content="Kevin van Zonneveld">

  
  <meta name="description" content="JavaScript file_get_contents function A JavaScript equivalent of PHP&#8217;s file_get_contents filesystem/file_get_contents.js raw on github 1
2
3
4 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://phpjs.org/functions/file_get_contents/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="php.js" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-63083-7']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">php</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">.js</a></h1>
  
    <h2>A resource of php functions in JavaScript</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:phpjs.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Blog</a></li>
  <li><a href="/functions">Functions</a></li>
  <li><a href="/authors">Authors</a></li>
  <li><a target="_blank" href="https://github.com/kvz/phpjs/wiki/_pages">Wiki</a></li>
  <li><a target="_blank"  href="http://twitter.com/phpjs">@phpjs</a></li>
  <li><a target="_blank"  href="http://identi.ca/brettz9">@brettz9</a></li>
  <li><a target="_blank"  href="http://twitter.com/kvz">@kvz</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">JavaScript file_get_contents function</h1>
    
  </header>
  
  <!-- Generated by Rakefile:build -->


<p>A JavaScript equivalent of PHP&#8217;s file_get_contents</p>

<figure class='code'><figcaption><span>filesystem/file_get_contents.js </span><a href='https://raw.github.com/kvz/phpjs/master/functions/filesystem/file_get_contents.js'>raw on github </a></figcaption> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">file_get_contents</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">flags</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">maxLen</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Read the entire file into a string</span>
</span><span class='line'>  <span class="c1">//</span>
</span><span class='line'>  <span class="c1">// version: 906.111</span>
</span><span class='line'>  <span class="c1">// discuss at: http://phpjs.org/functions/file_get_contents</span>
</span><span class='line'>  <span class="c1">// +   original by: Legaev Andrey</span>
</span><span class='line'>  <span class="c1">// +      input by: Jani Hartikainen</span>
</span><span class='line'>  <span class="c1">// +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)</span>
</span><span class='line'>  <span class="c1">// +   improved by: Brett Zamir (http://brett-zamir.me)</span>
</span><span class='line'>  <span class="c1">// +   input by: Raphael (Ao) RUDLER</span>
</span><span class='line'>  <span class="c1">// +   bugfixed by: Brett Zamir (http://brett-zamir.me)</span>
</span><span class='line'>  <span class="c1">// %        note 1: This function uses XmlHttpRequest and cannot retrieve resource from different domain without modifications.</span>
</span><span class='line'>  <span class="c1">// %        note 2: Synchronous by default (as in PHP) so may lock up browser. Can</span>
</span><span class='line'>  <span class="c1">// %        note 2: get async by setting a custom &quot;phpjs.async&quot; property to true and &quot;notification&quot; for an</span>
</span><span class='line'>  <span class="c1">// %        note 2: optional callback (both as context params, with responseText, and other JS-specific</span>
</span><span class='line'>  <span class="c1">// %        note 2: request properties available via &#39;this&#39;). Note that file_get_contents() will not return the text</span>
</span><span class='line'>  <span class="c1">// %        note 2: in such a case (use this.responseText within the callback). Or, consider using</span>
</span><span class='line'>  <span class="c1">// %        note 2: jQuery&#39;s: $(&#39;#divId&#39;).load(&#39;http://url&#39;) instead.</span>
</span><span class='line'>  <span class="c1">// %        note 3: The context argument is only implemented for http, and only partially (see below for</span>
</span><span class='line'>  <span class="c1">// %        note 3: &quot;Presently unimplemented HTTP context options&quot;); also the arguments passed to</span>
</span><span class='line'>  <span class="c1">// %        note 3: notification are incomplete</span>
</span><span class='line'>  <span class="c1">// *     example 1: file_get_contents(&#39;http://kevin.vanzonneveld.net/pj_test_supportfile_1.htm&#39;);</span>
</span><span class='line'>  <span class="c1">// *     returns 1: &#39;123&#39;</span>
</span><span class='line'>  <span class="c1">// Note: could also be made to optionally add to global $http_response_header as per http://php.net/manual/en/reserved.variables.httpresponseheader.php</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">tmp</span><span class="p">,</span> <span class="nx">headers</span> <span class="o">=</span> <span class="p">[],</span>
</span><span class='line'>    <span class="nx">newTmp</span> <span class="o">=</span> <span class="p">[],</span>
</span><span class='line'>    <span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">href</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">pathPos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">flagNames</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">content</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">http_stream</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">func</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// BEGIN REDUNDANT</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">php_js</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">php_js</span> <span class="o">||</span> <span class="p">{};</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">php_js</span><span class="p">.</span><span class="nx">ini</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">php_js</span><span class="p">.</span><span class="nx">ini</span> <span class="o">||</span> <span class="p">{};</span>
</span><span class='line'>  <span class="c1">// END REDUNDANT</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">ini</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">php_js</span><span class="p">.</span><span class="nx">ini</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">php_js</span><span class="p">.</span><span class="nx">default_streams_context</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">flags</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">OPTS</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">FILE_USE_INCLUDE_PATH</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">FILE_TEXT</span><span class="o">:</span> <span class="mi">32</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">FILE_BINARY</span><span class="o">:</span> <span class="mi">64</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">flags</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Allow for a single string or an array of string flags</span>
</span><span class='line'>    <span class="nx">flagNames</span> <span class="o">=</span> <span class="nx">flags</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">flags</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">flags</span><span class="p">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">flags</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">OPTS</span><span class="p">[</span><span class="nx">flags</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">flagNames</span> <span class="o">=</span> <span class="nx">flagNames</span> <span class="o">|</span> <span class="nx">OPTS</span><span class="p">[</span><span class="nx">flags</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">flagNames</span> <span class="o">&amp;</span> <span class="nx">OPTS</span><span class="p">.</span><span class="nx">FILE_BINARY</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">flagNames</span> <span class="o">&amp;</span> <span class="nx">OPTS</span><span class="p">.</span><span class="nx">FILE_TEXT</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// These flags shouldn&#39;t be together</span>
</span><span class='line'>    <span class="k">throw</span> <span class="s1">&#39;You cannot pass both FILE_BINARY and FILE_TEXT to file_get_contents()&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">((</span><span class="nx">flagNames</span> <span class="o">&amp;</span> <span class="nx">OPTS</span><span class="p">.</span><span class="nx">FILE_USE_INCLUDE_PATH</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">ini</span><span class="p">.</span><span class="nx">include_path</span> <span class="o">&amp;&amp;</span> <span class="nx">ini</span><span class="p">.</span><span class="nx">include_path</span><span class="p">.</span><span class="nx">local_value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">slash</span> <span class="o">=</span> <span class="nx">ini</span><span class="p">.</span><span class="nx">include_path</span><span class="p">.</span><span class="nx">local_value</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;/&#39;</span> <span class="o">:</span> <span class="s1">&#39;\\&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">url</span> <span class="o">=</span> <span class="nx">ini</span><span class="p">.</span><span class="nx">include_path</span><span class="p">.</span><span class="nx">local_value</span> <span class="o">+</span> <span class="nx">slash</span> <span class="o">+</span> <span class="nx">url</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="sr">/^(https?|file):/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">url</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// Allow references within or below the same directory (should fix to allow other relative references or root reference; could make dependent on parse_url())</span>
</span><span class='line'>    <span class="nx">href</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">pathPos</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">href</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">:</span> <span class="nx">href</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">url</span> <span class="o">=</span> <span class="nx">href</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">pathPos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nx">url</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">http_options</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">stream_options</span> <span class="o">&amp;&amp;</span> <span class="nx">context</span><span class="p">.</span><span class="nx">stream_options</span><span class="p">.</span><span class="nx">http</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">http_stream</span> <span class="o">=</span> <span class="o">!!</span> <span class="nx">http_options</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">context</span> <span class="o">||</span> <span class="nx">http_stream</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">ActiveXObject</span> <span class="o">?</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s1">&#39;Microsoft.XMLHTTP&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;XMLHttpRequest not supported&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">http_stream</span> <span class="o">?</span> <span class="nx">http_options</span><span class="p">.</span><span class="nx">method</span> <span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">async</span> <span class="o">=</span> <span class="o">!!</span> <span class="p">(</span><span class="nx">context</span> <span class="o">&amp;&amp;</span> <span class="nx">context</span><span class="p">.</span><span class="nx">stream_params</span> <span class="o">&amp;&amp;</span> <span class="nx">context</span><span class="p">.</span><span class="nx">stream_params</span><span class="p">[</span><span class="s1">&#39;phpjs.async&#39;</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">ini</span><span class="p">[</span><span class="s1">&#39;phpjs.ajaxBypassCache&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">ini</span><span class="p">[</span><span class="s1">&#39;phpjs.ajaxBypassCache&#39;</span><span class="p">].</span><span class="nx">local_value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">url</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\?/</span><span class="p">)</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s2">&quot;?&quot;</span> <span class="o">:</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">();</span> <span class="c1">// Give optional means of forcing bypass of cache</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">req</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">async</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">async</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">notification</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">stream_params</span><span class="p">.</span><span class="nx">notification</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">notification</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Fix: make work with req.addEventListener if available: https://developer.mozilla.org/En/Using_XMLHttpRequest</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">req</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Unimplemented so don&#39;t allow to get here</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">          req.addEventListener(&#39;progress&#39;, updateProgress, false);</span>
</span><span class='line'><span class="cm">          req.addEventListener(&#39;load&#39;, transferComplete, false);</span>
</span><span class='line'><span class="cm">          req.addEventListener(&#39;error&#39;, transferFailed, false);</span>
</span><span class='line'><span class="cm">          req.addEventListener(&#39;abort&#39;, transferCanceled, false);</span>
</span><span class='line'><span class="cm">          */</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">req</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">aEvt</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// aEvt has stopPropagation(), preventDefault(); see https://developer.mozilla.org/en/NsIDOMEvent</span>
</span><span class='line'>            <span class="c1">// Other XMLHttpRequest properties: multipart, responseXML, status, statusText, upload, withCredentials</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">  PHP Constants:</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_RESOLVE   1       A remote address required for this stream has been resolved, or the resolution failed. See severity  for an indication of which happened.</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_CONNECT   2     A connection with an external resource has been established.</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_AUTH_REQUIRED 3     Additional authorization is required to access the specified resource. Typical issued with severity level of STREAM_NOTIFY_SEVERITY_ERR.</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_MIME_TYPE_IS  4     The mime-type of resource has been identified, refer to message for a description of the discovered type.</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_FILE_SIZE_IS  5     The size of the resource has been discovered.</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_REDIRECTED    6     The external resource has redirected the stream to an alternate location. Refer to message .</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_PROGRESS  7     Indicates current progress of the stream transfer in bytes_transferred and possibly bytes_max as well.</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_COMPLETED 8     There is no more data available on the stream.</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_FAILURE   9     A generic error occurred on the stream, consult message and message_code for details.</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_AUTH_RESULT   10     Authorization has been completed (with or without success).</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_SEVERITY_INFO 0     Normal, non-error related, notification.</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_SEVERITY_WARN 1     Non critical error condition. Processing may continue.</span>
</span><span class='line'><span class="cm">  STREAM_NOTIFY_SEVERITY_ERR  2     A critical error occurred. Processing cannot continue.</span>
</span><span class='line'><span class="cm">  */</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">objContext</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">responseText</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">responseText</span><span class="p">,</span>
</span><span class='line'>              <span class="nx">responseXML</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">responseXML</span><span class="p">,</span>
</span><span class='line'>              <span class="nx">status</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span>
</span><span class='line'>              <span class="nx">statusText</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">statusText</span><span class="p">,</span>
</span><span class='line'>              <span class="nx">readyState</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">readyState</span><span class="p">,</span>
</span><span class='line'>              <span class="nx">evt</span><span class="o">:</span> <span class="nx">aEvt</span>
</span><span class='line'>            <span class="p">};</span> <span class="c1">// properties are not available in PHP, but offered on notification via &#39;this&#39; for convenience</span>
</span><span class='line'>            <span class="c1">// notification args: notification_code, severity, message, message_code, bytes_transferred, bytes_max (all int&#39;s except string &#39;message&#39;)</span>
</span><span class='line'>            <span class="c1">// Need to add message, etc.</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">bytes_transferred</span><span class="p">;</span>
</span><span class='line'>            <span class="k">switch</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">readyState</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>              <span class="c1">//     UNINITIALIZED     open() has not been called yet.</span>
</span><span class='line'>              <span class="nx">notification</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">objContext</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>              <span class="c1">//     LOADING     send() has not been called yet.</span>
</span><span class='line'>              <span class="nx">notification</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">objContext</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>              <span class="c1">//     LOADED     send() has been called, and headers and status are available.</span>
</span><span class='line'>              <span class="nx">notification</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">objContext</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>              <span class="c1">//     INTERACTIVE     Downloading; responseText holds partial data.</span>
</span><span class='line'>              <span class="nx">bytes_transferred</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">responseText</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// One character is two bytes</span>
</span><span class='line'>              <span class="nx">notification</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">objContext</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">bytes_transferred</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>              <span class="c1">//     COMPLETED     The operation is complete.</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">req</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">bytes_transferred</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">responseText</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// One character is two bytes</span>
</span><span class='line'>                <span class="nx">notification</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">objContext</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span> <span class="nx">bytes_transferred</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">403</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Fix: These two are finished except for message</span>
</span><span class='line'>                <span class="nx">notification</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">objContext</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// Errors</span>
</span><span class='line'>                <span class="nx">notification</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">objContext</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="k">default</span><span class="o">:</span>
</span><span class='line'>              <span class="k">throw</span> <span class="s1">&#39;Unrecognized ready state for file_get_contents()&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">http_stream</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">sendHeaders</span> <span class="o">=</span> <span class="nx">http_options</span><span class="p">.</span><span class="nx">header</span> <span class="o">&amp;&amp;</span> <span class="nx">http_options</span><span class="p">.</span><span class="nx">header</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\r?\n/</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">userAgentSent</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sendHeaders</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">sendHeader</span> <span class="o">=</span> <span class="nx">sendHeaders</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">breakPos</span> <span class="o">=</span> <span class="nx">sendHeader</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="sr">/:\s*/</span><span class="p">);</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">sendHeaderName</span> <span class="o">=</span> <span class="nx">sendHeader</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">breakPos</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">req</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="nx">sendHeaderName</span><span class="p">,</span> <span class="nx">sendHeader</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">breakPos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">sendHeaderName</span> <span class="o">===</span> <span class="s1">&#39;User-Agent&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">userAgentSent</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">userAgentSent</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">user_agent</span> <span class="o">=</span> <span class="nx">http_options</span><span class="p">.</span><span class="nx">user_agent</span> <span class="o">||</span> <span class="p">(</span><span class="nx">ini</span><span class="p">.</span><span class="nx">user_agent</span> <span class="o">&amp;&amp;</span> <span class="nx">ini</span><span class="p">.</span><span class="nx">user_agent</span><span class="p">.</span><span class="nx">local_value</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">user_agent</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">req</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">,</span> <span class="nx">user_agent</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">content</span> <span class="o">=</span> <span class="nx">http_options</span><span class="p">.</span><span class="nx">content</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">      // Presently unimplemented HTTP context options</span>
</span><span class='line'><span class="cm">      var request_fulluri = http_options.request_fulluri || false; // When set to TRUE, the entire URI will be used when constructing the request. (i.e. GET http://www.example.com/path/to/file.html HTTP/1.0). While this is a non-standard request format, some proxy servers require it.</span>
</span><span class='line'><span class="cm">      var max_redirects = http_options.max_redirects || 20; // The max number of redirects to follow. Value 1 or less means that no redirects are followed.</span>
</span><span class='line'><span class="cm">      var protocol_version = http_options.protocol_version || 1.0; // HTTP protocol version</span>
</span><span class='line'><span class="cm">      var timeout = http_options.timeout || (ini.default_socket_timeout &amp;&amp; ini.default_socket_timeout.local_value); // Read timeout in seconds, specified by a float</span>
</span><span class='line'><span class="cm">      var ignore_errors = http_options.ignore_errors || false; // Fetch the content even on failure status codes.</span>
</span><span class='line'><span class="cm">      */</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">flagNames</span> <span class="o">&amp;</span> <span class="nx">OPTS</span><span class="p">.</span><span class="nx">FILE_TEXT</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Overrides how encoding is treated (regardless of what is returned from the server)</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">content_type</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">http_options</span> <span class="o">&amp;&amp;</span> <span class="nx">http_options</span><span class="p">[</span><span class="s1">&#39;phpjs.override&#39;</span><span class="p">])</span> <span class="p">{</span> <span class="c1">// Fix: Could allow for non-HTTP as well</span>
</span><span class='line'>        <span class="nx">content_type</span> <span class="o">=</span> <span class="nx">http_options</span><span class="p">[</span><span class="s1">&#39;phpjs.override&#39;</span><span class="p">];</span> <span class="c1">// We use this, e.g., in gettext-related functions if character set</span>
</span><span class='line'>        <span class="c1">//   overridden earlier by bind_textdomain_codeset()</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">encoding</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ini</span><span class="p">[</span><span class="s1">&#39;unicode.stream_encoding&#39;</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">ini</span><span class="p">[</span><span class="s1">&#39;unicode.stream_encoding&#39;</span><span class="p">].</span><span class="nx">local_value</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">http_options</span> <span class="o">&amp;&amp;</span> <span class="nx">http_options</span><span class="p">.</span><span class="nx">header</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="sr">/^content-type:/im</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">http_options</span><span class="p">.</span><span class="nx">header</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// We&#39;ll assume a content-type expects its own specified encoding if present</span>
</span><span class='line'>          <span class="nx">content_type</span> <span class="o">=</span> <span class="nx">http_options</span><span class="p">.</span><span class="nx">header</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^content-type:\s*(.*)$/im</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// We let any header encoding stand</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="sr">/;\s*charset=/</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">content_type</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// If no encoding</span>
</span><span class='line'>          <span class="nx">content_type</span> <span class="o">+=</span> <span class="s1">&#39;; charset=&#39;</span> <span class="o">+</span> <span class="nx">encoding</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">req</span><span class="p">.</span><span class="nx">overrideMimeType</span><span class="p">(</span><span class="nx">content_type</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">// Default is FILE_BINARY, but for binary, we apparently deviate from PHP in requiring the flag, since many if not</span>
</span><span class='line'>    <span class="c1">//     most people will also want a way to have it be auto-converted into native JavaScript text instead</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">flagNames</span> <span class="o">&amp;</span> <span class="nx">OPTS</span><span class="p">.</span><span class="nx">FILE_BINARY</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Trick at https://developer.mozilla.org/En/Using_XMLHttpRequest to get binary</span>
</span><span class='line'>      <span class="nx">req</span><span class="p">.</span><span class="nx">overrideMimeType</span><span class="p">(</span><span class="s1">&#39;text/plain; charset=x-user-defined&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="c1">// Getting an individual byte then requires:</span>
</span><span class='line'>      <span class="c1">// responseText.charCodeAt(x) &amp; 0xFF; // throw away high-order byte (f7) where x is 0 to responseText.length-1 (see notes in our substr())</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">http_options</span> <span class="o">&amp;&amp;</span> <span class="nx">http_options</span><span class="p">[</span><span class="s1">&#39;phpjs.sendAsBinary&#39;</span><span class="p">])</span> <span class="p">{</span> <span class="c1">// For content sent in a POST or PUT request (use with file_put_contents()?)</span>
</span><span class='line'>      <span class="nx">req</span><span class="p">.</span><span class="nx">sendAsBinary</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span> <span class="c1">// In Firefox, only available FF3+</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">req</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">getAllResponseHeaders</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">tmp</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">k</span> <span class="o">&lt;</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">func</span><span class="p">(</span><span class="nx">tmp</span><span class="p">[</span><span class="nx">k</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">newTmp</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tmp</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">newTmp</span><span class="p">;</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">headers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">$http_response_header</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">;</span> <span class="c1">// see http://php.net/manual/en/reserved.variables.httpresponseheader.php</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">offset</span> <span class="o">||</span> <span class="nx">maxLen</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">maxLen</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">req</span><span class="p">.</span><span class="nx">responseText</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">offset</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">maxLen</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">req</span><span class="p">.</span><span class="nx">responseText</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">offset</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">req</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://github.com/kvz/phpjs/blob/master/functions/filesystem/file_get_contents.js">view on github</a></li>
<li><a href="https://github.com/kvz/phpjs/edit/master/functions/filesystem/file_get_contents.js">edit on github</a></li>
</ul>


<h3>Example 1</h3>

<p>This code</p>

<figure class='code'><figcaption><span>example </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">file_get_contents</span><span class="p">(</span><span class="s1">&#39;http://kevin.vanzonneveld.net/pj_test_supportfile_1.htm&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Should return</p>

<figure class='code'><figcaption><span>returns </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="s1">&#39;123&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Other PHP functions in the filesystem extension</h3>

<!-- Generated by Rakefile:build -->


<ul>
<li><a href="/functions/basename">basename</a></li>
<li><a href="/functions/dirname">dirname</a></li>
<li><a href="/functions/fclose">fclose</a></li>
<li><a href="/functions/feof">feof</a></li>
<li><a href="/functions/fgetc">fgetc</a></li>
<li><a href="/functions/fgetcsv">fgetcsv</a></li>
<li><a href="/functions/fgets">fgets</a></li>
<li><a href="/functions/fgetss">fgetss</a></li>
<li><a href="/functions/file">file</a></li>
<li><a href="/functions/file_exists">file_exists</a></li>
<li><a href="/functions/file_get_contents">file_get_contents</a></li>
<li><a href="/functions/filemtime">filemtime</a></li>
<li><a href="/functions/filesize">filesize</a></li>
<li><a href="/functions/fopen">fopen</a></li>
<li><a href="/functions/fpassthru">fpassthru</a></li>
<li><a href="/functions/fread">fread</a></li>
<li><a href="/functions/fscanf">fscanf</a></li>
<li><a href="/functions/fseek">fseek</a></li>
<li><a href="/functions/ftell">ftell</a></li>
<li><a href="/functions/pathinfo">pathinfo</a></li>
<li><a href="/functions/pclose">pclose</a></li>
<li><a href="/functions/popen">popen</a></li>
<li><a href="/functions/readfile">readfile</a></li>
<li><a href="/functions/realpath">realpath</a></li>
<li><a href="/functions/rewind">rewind</a></li>
</ul>


<h2>Legacy comments</h2>

<p>These were imported from our old site. Please use disqus below for new comments</p>

<div style="overflow-y: scroll; max-height: 500px;">
<!-- Generated by Rakefile:build -->

<strong>
<a href="http://webseoranks.com/wherecanibuya.org" rel="nofollow">Justin Bieber</a>
</strong>
on 2012-09-19 11:38:33 <br />
Heya just wanted to give you a quick heads up and let you know a few of the pictures aren&#8217;t loading correctly. I&#8217;m 
not sure why but I think its a linking issue. I&#8217;ve tried it in two different browsers and both show the same results.
<hr />


<strong>
<a href="http://an3m1.com/" rel="nofollow">????? ???</a>
</strong>
on 2012-05-06 09:29:03 <br />
I have a lot to benefit from this article and thank you for this wonderful effort to this article and will continue my many articles you have other  
<hr />


<strong>
Bydracrarkano
</strong>
on 2011-01-16 04:23:42 <br />

<hr />


<strong>
<a href="http://ironmagma.com/" rel="nofollow">Philip Peterson</a>
</strong>
on 2010-11-16 20:49:14 <br />
@Kevin van Zonneveld: Might want to know that your test URL, http://kevin.vanzonneveld.net/pj_test_supportfile_1.htm, is bork&#8217;d (redirects to the main page).
<hr />


<strong>
chechu
</strong>
on 2010-11-10 08:42:02 <br />
<pre><code>
function dato(){
var dato = document.getElementById('tag').innerHTML=file_get_contents('archivo.php');
}
setInterval(&quot;dato()&quot;,10000);
</code></pre>


FF ok , IE ERROR.

Internet Explorer does not work, how to make it work?
<hr />


<strong>
<a href="---" rel="nofollow">chechu</a>
</strong>
on 2010-11-10 00:34:55 <br />
How I can make file_get_contents funcnione in Internet Explorer?

Thanks
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;


¿como puedo hacer que file_get_contents funcnione en internet explorer?


Gracias
<hr />


<strong>
<a href="http://games.konseo.com" rel="nofollow">?????</a>
</strong>
on 2010-09-19 06:47:40 <br />
My host can not use this fuction
but thanks
<hr />


<strong>
<a href="http://brett-zamir.me" rel="nofollow">Brett Zamir</a>
</strong>
on 2010-02-19 07:11:09 <br />
@Jack Mason: Yeah, sometimes it take a while for the site to reflect the source, but in this case, at least by the time I got to it, it looks like they are the same? Anyhow, hope your issue is now settled. So, you&#8217;re making use of the context fields?
<hr />


<strong>
<a href="www.mybfl.com" rel="nofollow">Jack Mason</a>
</strong>
on 2010-02-17 21:29:20 <br />
The code above is not the same as the raw source, so users need to insure they pull down the raw source.
<hr />


<strong>
<a href="www.mybfl.com" rel="nofollow">Jack Mason</a>
</strong>
on 2010-02-17 20:43:12 <br />
Line 177 appears to be an &quot;if&quot; without a &quot;true&quot; clause because &quot;req.sendAsBinary(content);&quot; is commented out.  Is this the way it is supposed to be?
<hr />


<strong>
Leosek
</strong>
on 2010-01-09 12:50:02 <br />
Here is the error:

Error: uncaught exception: [Exception&#8230; &quot;Component returned failure code: 0x80004005 (NS_ERROR_FAILURE) [nsIXMLHttpRequest.send]&quot;  nsresult: &quot;0x80004005 (NS_ERROR_FAILURE)&quot;  location: &quot;JS frame :: file:///C:/jscript/test_last.html :: file_get_contents :: line 227&quot;  data: no]

and line 227 is accidentally the same as line 227 on this page
<hr />


<strong>
<a href="http://brett-zamir.me" rel="nofollow">Brett Zamir</a>
</strong>
on 2010-01-09 03:30:38 <br />
Firefox is the browser I usually use for testing, unless someone reports a bug elsewhere. What problem(s) were you having? Some sample code maybe? When in Firefox, what errors are you getting in Tools-&gt;Error Console ?
<hr />


<strong>
Leosek
</strong>
on 2010-01-09 01:12:29 <br />
Hi, is this function tested in other than IE-based browsers? I&#8217;m not able to make it work in e.g. firefox, opera, google chrome. In IE it works fine.

thanks
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2009-12-14 15:38:05 <br />
@ Eligio: Be sure to let us know when you find a bug!
<hr />


<strong>
<a href="http://www.eligio.org" rel="nofollow">Eligio</a>
</strong>
on 2009-12-03 23:36:03 <br />
wow, that save me from coding&#8230;time for testing. thanks
<hr />


<strong>
<a href="http://bahai-library.com" rel="nofollow">Brett Zamir</a>
</strong>
on 2009-06-21 03:21:10 <br />
@Jeffrey: I see in the XMLHttpRequest draft at the W3C that overrideMimeType() is not yet standardized on. It should work in at least Firefox, so you can confirm for yourself that it works there, but I&#8217;m not familiar with support elsewhere, so it looks like that won&#8217;t be a robust solution for now.

Also, the scheme the spec mentions for handling character sets indeed does not inspect on the &lt;meta/&gt; tags to detect character set (though HTML 5 still will! http://www.whatwg.org/specs/web-apps/current-work/#attr-meta-http-equiv-content-type ), so unless someone complains to the spec team and they accept a change, XMLHttpRequest() doesn&#8217;t look like it will ever automatically handle meta tag encodings with responseText by the looks of things. (DOMParser() is being discussed as a standardization candidate, which could perhaps, if given a &quot;text/html&quot; argument, check for meta encodings, but that is not implemented or agreed upon.)

If you are talking about a regular website (and not privileged JS like in a browser extension), you need to be in control of the targeted website anyways (we don&#8217;t have cross-domain support implemented in file_get_contents() yet, and it requires explicit server permissions anyways).

So, it looks like your options are:

1) get the site to either: A) upgrade to utf8 (best solution for everyone and most future proof solution) or, B) to at least send a header which indicates the current character set they are using. This can be easily done in the likes of PHP by adding a line at the top of your PHP script like this (should be before even any whitespace is sent by the browser, so make sure your beginning &lt;?php &#8230;?&gt; block is not preceded by whitespace or HTML, and if it is, add a PHP block with the following line before it):

&quot;header(&#8216;Content-Type: text/html;charset=gb2312)&quot; (replacing &quot;gb2312&quot; with the character set being sent out by the website in its meta tag)

2) find a JS conversion algorithm of the site&#8217;s character set into Unicode (be sure to share it here if you do!&#8211;unicode_encode() could use this: http://php.net/manual/en/function.unicode-encode.php &#8211;although we already have utf8_encode() implemented, that only works for Latin-1)). But as with overrideMimeType(), you&#8217;ll need to know, guess, or extract the character set to make the conversion.
<hr />


<strong>
Jeffrey Brown
</strong>
on 2009-06-20 20:24:26 <br />
@Brett: Thanks for looking into this. I just tried inserting that line (req.overrideMimeType&#8230;) in the function and received the error &quot;Object doesn&#8217;t support this property or method.&quot;
<hr />


<strong>
<a href="http://bahai-library.com" rel="nofollow">Brett Zamir</a>
</strong>
on 2009-06-20 11:51:41 <br />
@Jeffrey Brown: I believe the issue is probably due to Ajax having trouble detecting the correct MIME type. For example, in Firefox, when I use file_get_contents() on http://www.sina.com , a Chinese website in the gb2312 encoding, I also get question marks (though if you load it in the browser, it is ok). I don&#8217;t have the same problem when loading a file which has the proper character encoding set in the server&#8217;s response header: e.g., http://bahai-academic.hk/?langu=zh-CN

While I would have thought that setting a header like &quot;Accept-Charset&quot; would work (you can set headers through the stream context argument in file_get_contents() if need be), it didn&#8217;t. It seems, at least in cases where the website doesn&#8217;t set a content type header (when the browser can only get the encoding by parsing the text for meta tags, etc.) one must instead actually manually override the mime type (how the content is treated after it is returned from the server):

<pre><code>req.overrideMimeType('text/html; charset=gb2312');</code></pre>

I&#8217;m not sure how to best implement this in file_get_contents(). I think we might solve this by adding our own custom option to the stream context which allowed overriding the mime type instead of just sending an (optional) request header. Maybe we can name the option &quot;phpjs.overrideMimeType&quot;?
<hr />


<strong>
Jeffrey Brown
</strong>
on 2009-06-20 10:12:54 <br />
Whenever I call this I get question marks for anything with ascii value over 127
<hr />


<strong>
<a href="http://bahai-library.com" rel="nofollow">Brett Zamir</a>
</strong>
on 2009-05-15 00:16:27 <br />
@Caleb and Ben: Sorry we missed your question, Caleb, and thanks for answering Ben.

What Ben said is true, but as of Firefox 3.5 (and possibly other newer browsers, though no doubt not Explorer yet), it is possible for servers to indicate they are willing to accept certain Ajax from other sites, but they have to do so explicitly: https://developer.mozilla.org/En/HTTP_Access_Control

Another client-side alternative (though more challenging for a beginner) is to use the JavaScript inside of an extension or widget which has privileges, or use &quot;signed&quot; JavaScript in HTML for which permission is required from the user (though this may only work in certain browsers). In such a case, access can take place cross-site, but it is something a bit more involved and may not work in all browsers. 

Actually, come to think of it, we might be able to ask for signed privileges from the user (for regular HTML JavaScript) in the function if the request doesn&#8217;t work&#8230;But again, this will require permission from the user and not necessarily work in all browsers.

It&#8217;s funny you all mention this now because I&#8217;m trying to add support for this function to work client-side in Firefox extensions by using the stream &quot;context&quot; argument in file_get_contents() to set up Mozilla-specific configuration, though this could also work for other HTML situations (e.g., controlling the headers and request type used for file_get_contents()). I can let you know how it goes if I can get it going, though there are a number of pieces to put together first before it can work.
<hr />


<strong>
Ben
</strong>
on 2009-05-14 18:27:04 <br />
@Caleb: Ajax is limted to not work accross domains. You will have to do that server side.
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2009-01-25 13:53:38 <br />
@ Brett Zamir: Fair enough.. Added
<hr />


<strong>
<a href="http://bahai-library.com" rel="nofollow">Brett Zamir</a>
</strong>
on 2009-01-19 14:56:22 <br />
Here&#8217;s another dependent to file_get_contents()&#8230; I&#8217;ve tried to make it more useful for JavaScript by not eliminating newlines (since they could be used without semicolons). I&#8217;m guessing there could be aspects I&#8217;ve missed, especially if you&#8217;re trying to be able to operate on PHP code.

<pre><code>
// You could use this for testing based on the PHP example, but note comment above
str = &amp;quot;&amp;lt;?php\n&amp;quot;+
&amp;quot;// PHP comment here\n&amp;quot;+
&amp;quot;\n&amp;quot;+
&amp;quot;/*\n&amp;quot;+
&amp;quot; * Another PHP comment\n&amp;quot;+
&amp;quot; */\n&amp;quot;+
&amp;quot;\n&amp;quot;+
&amp;quot;echo        php_strip_whitespace(__FILE__);\n&amp;quot;+
&amp;quot;// Newlines are considered whitespace, and are removed too:\n&amp;quot;+
&amp;quot;do_nothing();&amp;quot;+
&amp;quot;?&amp;gt;&amp;quot;;

// Depends on file_get_contents()
function php_strip_whitespace (file) {
    try {
        var str = file_get_contents(file);
    }
    catch (e) {
        return '';
    }
    // Strip comments (both styles), reduce non-newline whitespace to one, reduce multiple newlines (preceded by any whitespace) to a newline, remove WS at beginning of line, and at end of line
    return str.replace(/\/\/.*?\n/g, '').replace(/\/\*[^]*?\*\//g, '').replace(/[ \f\r\t\v\u00A0\u2028\u2029]+/g, ' ').replace(/\s*\n+/g, '\n').replace(/^\s+/gm, '').replace(/\s*$/gm, '');
}

alert(php_strip_whitespace('http://kevin.vanzonneveld.net/code/php_equivalents/php.namespaced.js'))
</code></pre>
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2009-01-14 11:15:27 <br />
@ Brett Zamir &amp; Onno Marsman: Sorry Onno&#8230; Added :)
<hr />


<strong>
<a href="http://bahai-library.com" rel="nofollow">Brett Zamir</a>
</strong>
on 2009-01-13 20:24:18 <br />
Here&#8217;s a function that depends on file_get_contents(). Note that I did not implement its second argument (for an include path), since local files aren&#8217;t supported anyways. This is a fun one to play around with actually.

function get_meta_tags (file) { 
    var fulltxt = file_get_contents(file).match(/^[^]*&amp;lt;\/head&amp;gt;/i);
/* Kevin, you could use this for testing instead of the line above:
var fulltxt = &#8216;&amp;lt;meta name=&amp;quot;author&amp;quot; content=&amp;quot;name&amp;quot;&amp;gt;&#8217;+
&#8216;&amp;lt;meta name=&amp;quot;keywords&amp;quot; content=&amp;quot;php documentation&amp;quot;&amp;gt;&#8217;+
&#8216;&amp;lt;meta name=&amp;quot;DESCRIPTION&amp;quot; content=&amp;quot;a php manual&amp;quot;&amp;gt;&#8217;+
&#8216;&amp;lt;meta name=&amp;quot;geo.position&amp;quot; content=&amp;quot;49.33;-86.59&amp;quot;&amp;gt;&#8217;+
&#8216;&amp;lt;/head&amp;gt;&#8217;;*/
    var patt = /&amp;lt;meta[^&amp;gt;]*?&amp;gt;/gim;
    var txt, match, name, arr={};
    while ((txt = patt.exec(fulltxt)) != null) {
        var patt1 = /&amp;lt;meta\s+.*?name\s*=\s*([&#8216;&amp;quot;]?)(.*?)\1\s+.*?content\s*=\s*([&#8216;&amp;quot;]?)(.*?)\3/gim;
        while ((match = patt1.exec(txt)) != null) {
            name = match[2].replace(/\W/g, &#8216;_&#8217;).toLowerCase();
            arr[name] = match[4];
        }
        var patt2 = /&amp;lt;meta\s+.*?content\s*=\s*([&#8216;&amp;quot;?])(.*?)\1\s+.*?name\s*=\s*([&#8216;&amp;quot;]?)(.*?)\3/gim;
        while ((match = patt2.exec(txt)) != null) {
            name = match[4].replace(/\W/g, &#8216;_&#8217;).toLowerCase();
            arr[name] = match[2];
        }
    }
    return arr;
}
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-11-13 23:07:03 <br />
Enrique GonzÃ¡lez: Cool Enrique! Thanks a LOT!
<hr />


<strong>
<a href="http://www.maciaspajas.com" rel="nofollow">Enrique González</a>
</strong>
on 2008-11-10 18:39:59 <br />
With JS it is not posible to retrieve a local file using file() or file_get_contents(), so it may be useful to use this same method using HEAD instead of GET to have the equivalent to filesize or file_exists

<pre><code>
function filesize( url ) {  
       var req = null;
       try { req = new ActiveXObject(&amp;quot;Msxml2.XMLHTTP&amp;quot;); } catch (e) {  
           try { req = new ActiveXObject(&amp;quot;Microsoft.XMLHTTP&amp;quot;); } catch (e) {  
               try { req = new XMLHttpRequest(); } catch(e) {}  
           }  
       }
       if (req == null) throw new Error('XMLHttpRequest not supported');
       req.open ('HEAD',url,false);
       req.send (null);
       return req.getResponseHeader('Content-Length');       
   }
</code></pre>

<pre><code>
function file_exists( url ) {  
       var req = null;
       try { req = new ActiveXObject(&amp;quot;Msxml2.XMLHTTP&amp;quot;); } catch (e) {  
           try { req = new ActiveXObject(&amp;quot;Microsoft.XMLHTTP&amp;quot;); } catch (e) {  
               try { req = new XMLHttpRequest(); } catch(e) {}  
           }  
       }
       if (req == null) throw new Error('XMLHttpRequest not supported');
       // HEAD Results are usually shorter (faster) than GET
       req.open ('HEAD',url,false);
       req.send (null);
       if (req.status ==200){ return true;}
           else {return false;}
   }
</code></pre>

I&#8217;m not quite sure if this functions fit correctly in php.js. Both functions won&#8217;t work with http files in php, but as I said before, php works with local files and js does not, so working with remote http files may be somehow equivalent.

Also the file_exists function may have different answers. Status code 200 means something exists, 404 it doesn&#8217;t, but there are lot&#8217;s of codes that mean different things.
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-10-02 23:56:34 <br />
@ Adnan Siddiqi: That is correct. Browser will prevent that because it&#8217;s considered a security risk.

@ Philippe Baumann: Good to see you back! Don&#8217;t forget to checkout work in progress at: http://phpjs.org That site will have much better submit features! Added your functions btw, thanks!
<hr />


<strong>
Philippe Baumann
</strong>
on 2008-10-02 21:55:19 <br />
Just found this project again and wanted to see how it&#8217;s going. I&#8217;m very impressed how much this library has grown since.

I&#8217;ve found the following two functions in my development folder. Admittedly, they&#8217;re not used very often and I also didn&#8217;t really come up with the first one myself, but you might still find them a nice addition:

<pre><code>
/*
string dechex ( int $number )

Returns a string containing a hexadecimal representation of the given number argument. 
The largest number that can be converted is 4294967295 in decimal resulting to &amp;quot;ffffffff&amp;quot;.
*/
function dechex(number)
{
    return number.toString(16);
}


/*
number hexdec ( string $hex_string )

Returns the decimal equivalent of the hexadecimal number represented by the hex_string argument. 
hexdec() converts a hexadecimal string to a decimal number.

hexdec() will ignore any non-hexadecimal characters it encounters.
*/
function hexdec(hex_string)
{
    hex_string = (hex_string+'').replace(/[^a-f0-9]/gi, '');
    return parseInt(hex_string, 16);
}
</code></pre>

By the way: Is there a better way to chat and submit functions than posting in the article for another function?
<hr />


<strong>
<a href="http://weblogs.com.pk/kadnan" rel="nofollow">Adnan Siddiqi</a>
</strong>
on 2008-10-02 11:38:13 <br />
It won&#8217;t work for cross domain calls
<hr />


<strong>
<a href="http://kevin.vanzonneveld.net" rel="nofollow">Kevin van Zonneveld</a>
</strong>
on 2008-07-18 08:58:02 <br />
Glad you found this helpful. I you want you can always help me spread the word on this project :)
<hr />


<strong>
Kyle Itterly
</strong>
on 2008-07-03 19:13:58 <br />
Just wanted to thank you for the javascript file_get_contents function, works great and was well documented. Unfortunately this reference was elusive on my google search of &amp;quot;read file javascript&amp;quot; and a lot of others were looking for something like this too based on that query.
<hr />


<strong>
<a href="http://www.gamesector.net/" rel="nofollow">Caleb</a>
</strong>
on 2009-02-27 20:24:55 <br />
I&#8217;m having a wee problem; this doesn&#8217;t appear to work cross-domains. Is that a limitation of this method?
<hr />


</div>


  
    <footer>
      
      
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://phpjs.org/functions/file_get_contents/index.html" data-via="phpjs" data-counturl="http://phpjs.org/functions/file_get_contents/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Kevin van Zonneveld -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
   -
  <span class="credit">Theme by <a href="http://melandri.net/2012/07/23/darkstripes-octopress-theme-released/">alessandro melandri</a></span>
</p>
</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'phpjs';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://phpjs.org/functions/file_get_contents/index.html';
        var disqus_url = 'http://phpjs.org/functions/file_get_contents/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
